<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Step 8 ‚Äî Manager: Assign Cleaner(s)</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  :root {
    --primary: #2b5fad;
    --primary-dark: #1f4e8a;
    --primary-light: #eef5ff;
    --secondary: #10b981;
    --secondary-dark: #0da271;
    --warning: #f59e0b;
    --danger: #dc3545;
    --light-bg: #f2f3f7;
    --card-bg: #ffffff;
    --text-primary: #1e293b;
    --text-secondary: #64748b;
    --border: #e0e0e0;
    --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --radius: 12px;
    --radius-sm: 8px;
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: "Poppins", "Segoe UI", sans-serif;
    background: linear-gradient(135deg, #f6f9ff 0%, #f1f5f9 100%);
    color: var(--text-primary);
    line-height: 1.6;
    min-height: 100vh;
    padding: 20px;
  }

  /* Main Container */
  .manager-panel {
    max-width: 1200px;
    margin: 40px auto;
    background: var(--card-bg);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    overflow: hidden;
  }

  /* Header */
  .panel-header {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    padding: 25px 30px;
  }

  .panel-header h1 {
    font-size: 28px;
    margin-bottom: 8px;
    font-weight: 700;
  }

  .panel-header p {
    opacity: 0.9;
    font-size: 16px;
  }

  .status-indicator {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: rgba(255, 255, 255, 0.2);
    padding: 8px 16px;
    border-radius: 20px;
    font-weight: 600;
    font-size: 14px;
    margin-top: 10px;
  }

  /* Content Area */
  .panel-content {
    padding: 30px;
  }

  /* Section Cards */
  .section-card {
    background: var(--card-bg);
    border-radius: var(--radius);
    padding: 25px;
    margin-bottom: 25px;
    border: 1px solid var(--border);
    box-shadow: 0 1px 4px rgba(0,0,0,0.05);
  }

  .section-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid var(--border);
  }

  .section-icon {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 20px;
  }

  .section-title h3 {
    font-size: 20px;
    color: var(--primary-dark);
    margin-bottom: 4px;
  }

  .section-title p {
    color: var(--text-secondary);
    font-size: 14px;
  }

  /* Filter Section */
  .filter-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 15px;
  }

  .filter-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .filter-label {
    font-weight: 600;
    color: var(--text-primary);
    font-size: 14px;
  }

  select, input[type="date"] {
    padding: 12px 15px;
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    font-family: inherit;
    font-size: 14px;
    background: white;
    transition: border 0.3s ease;
  }

  select:focus, input[type="date"]:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(43, 95, 173, 0.1);
  }

  /* Cleaner Database Section */
  .cleaner-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-top: 15px;
  }

  .stat-card {
    background: var(--light-bg);
    padding: 15px;
    border-radius: var(--radius-sm);
    text-align: center;
    border: 1px solid var(--border);
  }

  .stat-value {
    font-size: 24px;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 5px;
  }

  .stat-label {
    font-size: 12px;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  /* Appointments Table */
  .table-container {
    overflow-x: auto;
    margin-top: 15px;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
  }

  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
  }

  thead {
    background: var(--light-bg);
  }

  th {
    padding: 15px;
    text-align: left;
    font-weight: 600;
    color: var(--text-primary);
    border-bottom: 2px solid var(--border);
    white-space: nowrap;
  }

  td {
    padding: 15px;
    border-bottom: 1px solid var(--border);
    vertical-align: middle;
  }

  tbody tr {
    transition: background 0.2s ease;
  }

  tbody tr:hover {
    background: #f9f9ff;
  }

  /* Status Labels */
  .status-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .status-ready {
    background: #e6f0ff;
    color: var(--primary);
  }

  .status-scheduled {
    background: #e8fce8;
    color: #2c7a2c;
  }

  .status-completed {
    background: #f1f1f1;
    color: #666;
  }

  .status-paid {
    background: #fff3cd;
    color: #856404;
  }

  /* Cleaner Select Dropdown */
  .cleaner-select {
    min-width: 180px;
    position: relative;
  }

  .cleaner-select select {
    width: 100%;
    padding-right: 40px;
  }

  .team-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    background: #e8f4fd;
    color: var(--primary);
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 11px;
    margin-left: 5px;
  }

  /* Action Buttons */
  .action-buttons {
    display: flex;
    gap: 10px;
  }

  .btn {
    padding: 10px 18px;
    border: none;
    border-radius: var(--radius-sm);
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    white-space: nowrap;
  }

  .btn-primary {
    background: var(--primary);
    color: white;
  }

  .btn-primary:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(43, 95, 173, 0.2);
  }

  .btn-success {
    background: var(--secondary);
    color: white;
  }

  .btn-success:hover {
    background: var(--secondary-dark);
    transform: translateY(-2px);
  }

  .btn-success:disabled {
    background: #ccc;
    cursor: not-allowed;
    transform: none;
  }

  .btn-outline {
    background: transparent;
    color: var(--primary);
    border: 1px solid var(--primary);
  }

  .btn-outline:hover {
    background: var(--primary-light);
  }

  /* Notification Panel */
  .notification-panel {
    background: #f8f9fa;
    border-radius: var(--radius-sm);
    padding: 15px;
    margin-top: 15px;
    border-left: 4px solid var(--secondary);
    display: none;
  }

  .notification-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
  }

  .notification-icon {
    color: var(--secondary);
    font-size: 18px;
  }

  /* Cleaner Details Modal */
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    align-items: center;
    justify-content: center;
  }

  .modal-content {
    background: white;
    border-radius: var(--radius);
    padding: 30px;
    max-width: 600px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid var(--border);
  }

  .modal-close {
    background: none;
    border: none;
    font-size: 24px;
    color: var(--text-secondary);
    cursor: pointer;
    line-height: 1;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .panel-content {
      padding: 20px;
    }
    
    .section-card {
      padding: 20px;
    }
    
    .filter-grid {
      grid-template-columns: 1fr;
    }
    
    .table-container {
      font-size: 13px;
    }
    
    th, td {
      padding: 10px 8px;
    }
    
    .action-buttons {
      flex-direction: column;
    }
    
    .btn {
      width: 100%;
      justify-content: center;
    }
  }
</style>
</head>

<body>

<!-- Manager Panel -->
<div class="manager-panel">
  <button onclick="location.href='ManageBooking-nodecontent.html'">goback to node presentation</button>

  <!-- Header -->
  <div class="panel-header"
  >
    <h1>Step 8 ‚Äî Manager: Assign Cleaner(s)</h1>
    <p>Assign cleaner or cleaning team to confirmed appointments. Status ‚Üí <strong>scheduled</strong></p>
    <div class="status-indicator">
      <i class="fas fa-calendar-check"></i>
      <span>Manage Booking Module</span>
    </div>
  </div>

  <!-- Content Area -->
  <div class="panel-content">
    <!-- Workflow Description -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-icon">
          <i class="fas fa-info-circle"></i>
        </div>
        <div class="section-title">
          <h3>Workflow Context</h3>
          <p>This panel is displayed inside the Manage Booking module</p>
        </div>
      </div>
      <div style="padding: 15px; background: var(--light-bg); border-radius: var(--radius-sm);">
        <p style="margin-bottom: 10px;"><strong>Visibility Rules:</strong> Only appointments with status "Paid" or "Ready for Scheduling" appear in this interface.</p>
        <p style="margin-bottom: 10px;"><strong>Assignment Process:</strong> Managers can assign a single cleaner or a team to each appointment. Once assigned, the appointment status changes to "Scheduled" and notifications are automatically sent to both the client and assigned cleaner(s).</p>
        <p><strong>Data Sources:</strong> Appointment data is fetched from Step 6 (Invoice) and Step 7 (Payment Confirmation). Cleaner data is pulled from the internal HR database.</p>
      </div>
    </div>

    <!-- Filter Section -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-icon">
          <i class="fas fa-filter"></i>
        </div>
        <div class="section-title">
          <h3>Filter Appointments</h3>
          <p>Quickly find appointments by status, date, or service type</p>
        </div>
      </div>
      
      <div class="filter-grid">
        <div class="filter-group">
          <label class="filter-label">Status Filter</label>
          <select id="filterStatus" onchange="filterAppointments()">
            <option value="all">All Appointments</option>
            <option value="ready">Ready for Scheduling</option>
            <option value="paid">Paid</option>
            <option value="scheduled">Scheduled</option>
            <option value="completed">Completed</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label class="filter-label">Date Range</label>
          <input type="date" id="filterDate" onchange="filterAppointments()">
        </div>
        
        <div class="filter-group">
          <label class="filter-label">Service Type</label>
          <select id="filterService" onchange="filterAppointments()">
            <option value="all">All Services</option>
            <option value="deep">Deep Cleaning</option>
            <option value="moveout">Move-Out Cleaning</option>
            <option value="maintenance">Maintenance Clean</option>
            <option value="steam">Steam Clean</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Cleaner Database Info -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-icon">
          <i class="fas fa-user-friends"></i>
        </div>
        <div class="section-title">
          <h3>Cleaner Database</h3>
          <p>Available cleaners and teams for assignment</p>
        </div>
        <button class="btn btn-outline" onclick="viewCleanerDatabase()" style="margin-left: auto;">
          <i class="fas fa-database"></i> View All Cleaners
        </button>
      </div>
      
      <div class="cleaner-stats">
        <div class="stat-card">
          <div class="stat-value" id="availableCleaners">8</div>
          <div class="stat-label">Available Today</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="teamsCount">3</div>
          <div class="stat-label">Teams Available</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="avgRating">4.8</div>
          <div class="stat-label">Avg. Rating</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="appointmentsToday">12</div>
          <div class="stat-label">Today's Appointments</div>
        </div>
      </div>
    </div>

    <!-- Appointments Table -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-icon">
          <i class="fas fa-calendar-alt"></i>
        </div>
        <div class="section-title">
          <h3>Appointments Ready for Assignment</h3>
          <p>Assign cleaners to paid appointments</p>
        </div>
      </div>
      
      <div class="table-container">
        <table id="appointmentsTable">
          <thead>
            <tr>
              <th>Appointment ID</th>
              <th>Client Name</th>
              <th>Date / Time</th>
              <th>Service Type</th>
              <th>Address</th>
              <th>Total Price</th>
              <th>Cleaner Assigned</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="appointmentsBody">
            <!-- Appointment rows will be populated by JavaScript -->
          </tbody>
        </table>
      </div>
      
      <div id="notificationPanel" class="notification-panel">
        <div class="notification-header">
          <i class="fas fa-check-circle notification-icon"></i>
          <strong>Notifications Sent Successfully!</strong>
        </div>
        <p id="notificationMessage"></p>
      </div>
    </div>
    
    <!-- Action Summary -->
    <div class="section-card" style="text-align: center; background: linear-gradient(135deg, #f6f9ff 0%, #e8efff 100%);">
      <h3 style="color: var(--primary); margin-bottom: 10px;">Assignment Summary</h3>
      <p style="color: var(--text-secondary); margin-bottom: 15px;">
        <span id="assignedCount">0</span> appointments assigned | 
        <span id="pendingCount">0</span> pending assignment
      </p>
      <button class="btn btn-primary" onclick="exportAssignmentReport()">
        <i class="fas fa-file-export"></i> Export Assignment Report (CSV)
      </button>
    </div>
  </div>
</div>

<!-- Cleaner Details Modal -->
<div id="cleanerModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 style="color: var(--primary-dark);">Cleaner Details</h2>
      <button class="modal-close" onclick="closeCleanerModal()">√ó</button>
    </div>
    <div id="cleanerModalContent">
      <!-- Content populated by JavaScript -->
    </div>
  </div>
</div>

<script>
  // Sample data for appointments
  const appointments = [
    {
      id: "APT-CA-2025-010",
      client: "Sarah Johnson",
      date: "Nov 10, 2025 ‚Äî 10:00 AM",
      service: "Deep Cleaning",
      address: "123 Maple St, Toronto",
      price: "$450.00",
      status: "ready",
      paymentStatus: "paid",
      cleaner: "",
      cleanerOptions: [
        { id: "john", name: "John M.", rating: 4.9, team: false },
        { id: "teamA", name: "Team A", rating: 4.8, team: true },
        { id: "emily", name: "Emily R.", rating: 4.7, team: false }
      ]
    },
    {
      id: "APT-CA-2025-011",
      client: "Mark Davis",
      date: "Nov 11, 2025 ‚Äî 2:00 PM",
      service: "Move-Out Cleaning",
      address: "456 Oak Ave, Vancouver",
      price: "$650.00",
      status: "ready",
      paymentStatus: "paid",
      cleaner: "",
      cleanerOptions: [
        { id: "teamB", name: "Team B", rating: 4.6, team: true },
        { id: "liam", name: "Liam P.", rating: 4.8, team: false }
      ]
    },
    {
      id: "APT-CA-2025-012",
      client: "Jennifer Lee",
      date: "Nov 12, 2025 ‚Äî 9:00 AM",
      service: "Maintenance Clean",
      address: "789 Pine Rd, Montreal",
      price: "$285.00",
      status: "scheduled",
      paymentStatus: "paid",
      cleaner: "Team A",
      cleanerOptions: []
    },
    {
      id: "APT-CA-2025-013",
      client: "Robert Chen",
      date: "Nov 12, 2025 ‚Äî 1:00 PM",
      service: "Steam Clean",
      address: "321 Birch Blvd, Calgary",
      price: "$320.00",
      status: "paid",
      paymentStatus: "paid",
      cleaner: "",
      cleanerOptions: [
        { id: "john", name: "John M.", rating: 4.9, team: false },
        { id: "emily", name: "Emily R.", rating: 4.7, team: false }
      ]
    }
  ];

  // Sample data for cleaners
  const cleaners = [
    { id: "john", name: "John M.", rating: 4.9, phone: "+1 (416) 555-1234", email: "john@cleanpro.com", availability: "Available", team: false },
    { id: "emily", name: "Emily R.", rating: 4.7, phone: "+1 (416) 555-5678", email: "emily@cleanpro.com", availability: "Available", team: false },
    { id: "liam", name: "Liam P.", rating: 4.8, phone: "+1 (416) 555-9012", email: "liam@cleanpro.com", availability: "Available", team: false },
    { id: "teamA", name: "Team A", rating: 4.8, phone: "+1 (416) 555-3456", email: "team-a@cleanpro.com", availability: "Available", team: true },
    { id: "teamB", name: "Team B", rating: 4.6, phone: "+1 (416) 555-7890", email: "team-b@cleanpro.com", availability: "Available", team: true }
  ];

  // Initialize the page
  document.addEventListener('DOMContentLoaded', function() {
    renderAppointments();
    updateSummary();
  });

  // Render appointments table
  function renderAppointments(filteredData = appointments) {
    const tbody = document.getElementById('appointmentsBody');
    tbody.innerHTML = '';
    
    filteredData.forEach(appointment => {
      const row = document.createElement('tr');
      
      // Get status badge class
      let statusClass = 'status-ready';
      if (appointment.status === 'scheduled') statusClass = 'status-scheduled';
      if (appointment.status === 'completed') statusClass = 'status-completed';
      
      // Generate cleaner options HTML
      let cleanerOptionsHtml = '<option value="">Select Cleaner</option>';
      appointment.cleanerOptions.forEach(cleaner => {
        const teamBadge = cleaner.team ? '<span class="team-badge">üë• Team</span>' : '';
        cleanerOptionsHtml += `<option value="${cleaner.id}" ${appointment.cleaner === cleaner.id ? 'selected' : ''}>${cleaner.name} ${teamBadge}</option>`;
      });
      
      row.innerHTML = `
        <td><strong>${appointment.id}</strong></td>
        <td>${appointment.client}</td>
        <td>${appointment.date}</td>
        <td>${appointment.service}</td>
        <td style="font-size: 12px; color: var(--text-secondary);">${appointment.address}</td>
        <td><strong>${appointment.price}</strong></td>
        <td>
          <div class="cleaner-select">
            <select id="cleaner-${appointment.id}" onchange="updateCleanerSelection('${appointment.id}')" ${appointment.status === 'scheduled' ? 'disabled' : ''}>
              ${cleanerOptionsHtml}
            </select>
          </div>
        </td>
        <td>
          <span class="status-badge ${statusClass}">
            <i class="fas ${appointment.status === 'scheduled' ? 'fa-check-circle' : appointment.status === 'completed' ? 'fa-clipboard-check' : 'fa-clock'}"></i>
            ${appointment.status === 'ready' ? 'Ready for Scheduling' : appointment.status.charAt(0).toUpperCase() + appointment.status.slice(1)}
          </span>
          <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">
            ${appointment.paymentStatus === 'paid' ? '‚úÖ Paid' : '‚è≥ Pending'}
          </div>
        </td>
        <td>
          <div class="action-buttons">
            ${appointment.status !== 'scheduled' ? `
              <button class="btn btn-success" onclick="assignCleaner('${appointment.id}')" id="btn-${appointment.id}">
                <i class="fas fa-user-check"></i> Assign
              </button>
            ` : `
              <button class="btn btn-success" disabled>
                <i class="fas fa-check"></i> Assigned
              </button>
            `}
            <button class="btn btn-outline" onclick="viewAppointmentDetails('${appointment.id}')">
              <i class="fas fa-eye"></i>
            </button>
          </div>
        </td>
      `;
      
      tbody.appendChild(row);
    });
  }

  // Filter appointments based on filters
  function filterAppointments() {
    const statusFilter = document.getElementById('filterStatus').value;
    const serviceFilter = document.getElementById('filterService').value;
    
    let filtered = appointments;
    
    if (statusFilter !== 'all') {
      filtered = filtered.filter(app => {
        if (statusFilter === 'ready') return app.status === 'ready';
        if (statusFilter === 'paid') return app.paymentStatus === 'paid';
        if (statusFilter === 'scheduled') return app.status === 'scheduled';
        if (statusFilter === 'completed') return app.status === 'completed';
        return true;
      });
    }
    
    if (serviceFilter !== 'all') {
      filtered = filtered.filter(app => {
        const serviceLower = app.service.toLowerCase();
        if (serviceFilter === 'deep') return serviceLower.includes('deep');
        if (serviceFilter === 'moveout') return serviceLower.includes('move-out');
        if (serviceFilter === 'maintenance') return serviceLower.includes('maintenance');
        if (serviceFilter === 'steam') return serviceLower.includes('steam');
        return true;
      });
    }
    
    renderAppointments(filtered);
    updateSummary(filtered);
  }

  // Update cleaner selection
  function updateCleanerSelection(appointmentId) {
    const select = document.getElementById(`cleaner-${appointmentId}`);
    const appointment = appointments.find(a => a.id === appointmentId);
    
    if (appointment) {
      appointment.cleaner = select.value;
      
      // Enable/disable assign button based on selection
      const assignBtn = document.getElementById(`btn-${appointmentId}`);
      if (assignBtn) {
        assignBtn.disabled = !select.value;
      }
    }
  }

  // Assign cleaner to appointment
  function assignCleaner(appointmentId) {
    const appointment = appointments.find(a => a.id === appointmentId);
    if (!appointment) return;
    
    const select = document.getElementById(`cleaner-${appointmentId}`);
    const cleanerId = select.value;
    
    if (!cleanerId) {
      alert("Please select a cleaner before assigning.");
      return;
    }
    
    // Find cleaner details
    const cleaner = cleaners.find(c => c.id === cleanerId);
    if (!cleaner) return;
    
    // Update appointment
    appointment.status = 'scheduled';
    appointment.cleaner = cleanerId;
    
    // Update UI
    const assignBtn = document.getElementById(`btn-${appointmentId}`);
    if (assignBtn) {
      assignBtn.disabled = true;
      assignBtn.innerHTML = '<i class="fas fa-check"></i> Assigned';
      assignBtn.className = 'btn btn-success';
    }
    
    // Disable the select dropdown
    select.disabled = true;
    
    // Show notification
    showNotification(appointment, cleaner);
    
    // Update summary
    updateSummary();
    
    // Re-render to update status badges
    renderAppointments();
  }

  // Show notification after assignment
  function showNotification(appointment, cleaner) {
    const notificationPanel = document.getElementById('notificationPanel');
    const notificationMessage = document.getElementById('notificationMessage');
    
    notificationMessage.innerHTML = `
      <strong>Cleaner Assigned:</strong> ${cleaner.name}<br>
      <strong>Appointment:</strong> ${appointment.id} - ${appointment.service}<br>
      <strong>Date:</strong> ${appointment.date}<br>
      <strong>Notifications Sent:</strong> 
      <ul style="margin-top: 8px; margin-left: 20px;">
        <li>üìß Email sent to ${appointment.client} at client email</li>
        <li>üì± SMS sent to ${cleaner.name} at ${cleaner.phone}</li>
        <li>üì± In-app notification sent to cleaner</li>
      </ul>
    `;
    
    notificationPanel.style.display = 'block';
    
    // Auto-hide after 10 seconds
    setTimeout(() => {
      notificationPanel.style.display = 'none';
    }, 10000);
  }

  // View cleaner database
  function viewCleanerDatabase() {
    const modalContent = document.getElementById('cleanerModalContent');
    let html = '<h3 style="margin-bottom: 15px; color: var(--primary);">Available Cleaners & Teams</h3>';
    
    cleaners.forEach(cleaner => {
      html += `
        <div style="padding: 15px; margin-bottom: 10px; border: 1px solid var(--border); border-radius: var(--radius-sm);">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
            <div>
              <strong style="font-size: 16px;">${cleaner.name}</strong>
              ${cleaner.team ? '<span class="team-badge" style="margin-left: 10px;">üë• Team</span>' : ''}
            </div>
            <div style="color: var(--warning);">
              <i class="fas fa-star"></i> ${cleaner.rating}
            </div>
          </div>
          <div style="font-size: 14px; color: var(--text-secondary);">
            <div><i class="fas fa-phone"></i> ${cleaner.phone}</div>
            <div><i class="fas fa-envelope"></i> ${cleaner.email}</div>
            <div><i class="fas fa-calendar-check"></i> ${cleaner.availability}</div>
          </div>
        </div>
      `;
    });
    
    modalContent.innerHTML = html;
    document.getElementById('cleanerModal').style.display = 'flex';
  }

  // Close cleaner modal
  function closeCleanerModal() {
    document.getElementById('cleanerModal').style.display = 'none';
  }

  // View appointment details
  function viewAppointmentDetails(appointmentId) {
    const appointment = appointments.find(a => a.id === appointmentId);
    if (!appointment) return;
    
    const modalContent = document.getElementById('cleanerModalContent');
    const assignedCleaner = appointment.cleaner ? cleaners.find(c => c.id === appointment.cleaner) : null;
    
    html = `
      <h3 style="margin-bottom: 15px; color: var(--primary);">Appointment Details</h3>
      <div style="background: var(--light-bg); padding: 15px; border-radius: var(--radius-sm); margin-bottom: 15px;">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
          <div>
            <strong style="display: block; color: var(--text-secondary); font-size: 12px;">Appointment ID</strong>
            <span style="font-weight: 600;">${appointment.id}</span>
          </div>
          <div>
            <strong style="display: block; color: var(--text-secondary); font-size: 12px;">Client</strong>
            <span>${appointment.client}</span>
          </div>
          <div>
            <strong style="display: block; color: var(--text-secondary); font-size: 12px;">Date & Time</strong>
            <span>${appointment.date}</span>
          </div>
          <div>
            <strong style="display: block; color: var(--text-secondary); font-size: 12px;">Service Type</strong>
            <span>${appointment.service}</span>
          </div>
        </div>
        <div>
          <strong style="display: block; color: var(--text-secondary); font-size: 12px;">Address</strong>
          <span>${appointment.address}</span>
        </div>
      </div>
      
      <div style="background: var(--light-bg); padding: 15px; border-radius: var(--radius-sm); margin-bottom: 15px;">
        <strong style="display: block; margin-bottom: 10px; color: var(--primary);">Payment Information</strong>
        <div style="display: flex; justify-content: space-between;">
          <span>Total Price:</span>
          <strong>${appointment.price}</strong>
        </div>
        <div style="display: flex; justify-content: space-between; margin-top: 8px;">
          <span>Payment Status:</span>
          <span class="status-badge ${appointment.paymentStatus === 'paid' ? 'status-paid' : 'status-ready'}">
            ${appointment.paymentStatus === 'paid' ? '‚úÖ Paid' : '‚è≥ Pending'}
          </span>
        </div>
      </div>
    `;
    
    if (assignedCleaner) {
      html += `
        <div style="background: #e8fce8; padding: 15px; border-radius: var(--radius-sm);">
          <strong style="display: block; margin-bottom: 10px; color: #2c7a2c;">Assigned Cleaner</strong>
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <strong>${assignedCleaner.name}</strong>
              <div style="font-size: 14px; color: var(--text-secondary); margin-top: 4px;">
                <i class="fas fa-phone"></i> ${assignedCleaner.phone}
              </div>
            </div>
            <div style="color: var(--warning);">
              <i class="fas fa-star"></i> ${assignedCleaner.rating}
            </div>
          </div>
        </div>
      `;
    }
    
    modalContent.innerHTML = html;
    document.getElementById('cleanerModal').style.display = 'flex';
  }

  // Update assignment summary
  function updateSummary(filteredData = appointments) {
    const assignedCount = filteredData.filter(a => a.status === 'scheduled').length;
    const pendingCount = filteredData.filter(a => a.status === 'ready').length;
    
    document.getElementById('assignedCount').textContent = assignedCount;
    document.getElementById('pendingCount').textContent = pendingCount;
  }

  // Export assignment report
  function exportAssignmentReport() {
    const today = new Date().toISOString().split('T')[0];
    const assigned = appointments.filter(a => a.status === 'scheduled');
    
    let csvContent = "data:text/csv;charset=utf-8,";
    csvContent += "Appointment ID,Client,Date,Service,Cleaner Assigned,Status\n";
    
    assigned.forEach(app => {
      const cleaner = app.cleaner ? cleaners.find(c => c.id === app.cleaner)?.name || 'N/A' : 'N/A';
      csvContent += `${app.id},${app.client},${app.date},${app.service},${cleaner},${app.status}\n`;
    });
    
    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", `assignment-report-${today}.csv`);
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    alert(`Assignment report exported successfully!\n\n${assigned.length} assignments included.`);
  }

  // Close modal when clicking outside
  window.onclick = function(event) {
    const modal = document.getElementById('cleanerModal');
    if (event.target == modal) {
      closeCleanerModal();
    }
  }
</script>
</body>
</html>