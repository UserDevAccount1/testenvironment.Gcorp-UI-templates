
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --success-color: #4cc9f0;
            --warning-color: #f72585;
            --light-bg: #f8f9fa;
            --border-color: #e0e0e0;
        }

       
        .main-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
            overflow: hidden;
            margin: 0 auto;
             
    width: 100%; /* ADD THIS */
        }

        .dashboard-header {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 25px 30px;
            border-radius: 20px 20px 0 0;
        }

        .dashboard-header h1 {
            margin: 0;
            font-weight: 700;
            font-size: 2.2rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .dashboard-header h1 i {
            background: rgba(255,255,255,0.2);
            padding: 12px;
            border-radius: 12px;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            padding: 25px 30px;
            background: var(--light-bg);
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .stat-content h3 {
            margin: 0;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .stat-content p {
            margin: 5px 0 0;
            color: #666;
            font-size: 0.9rem;
        }

        /* Controls Section */
        .controls-section {
            padding: 20px 30px;
            background: white;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            justify-content: space-between;
        }

        .column-visibility {
            position: relative;
        }

        .column-toggle-btn {
            background: var(--light-bg);
            border: 1px solid var(--border-color);
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .column-toggle-btn:hover {
            background: #e9ecef;
        }

        .column-checkboxes {
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            z-index: 1000;
            min-width: 200px;
            display: none;
        }

        .column-checkboxes.show {
            display: block;
        }

        .column-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 0;
            cursor: pointer;
        }

        .search-filter-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .search-input {
            padding: 8px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            width: 250px;
        }

        .filter-select {
            padding: 8px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: white;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .btn-custom {
            padding: 8px 15px;
            border-radius: 8px;
            border: none;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary-custom {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary-custom:hover {
            background: var(--secondary-color);
        }

        .btn-success-custom {
            background: #28a745;
            color: white;
        }

        .btn-warning-custom {
            background: #ffc107;
            color: #212529;
        }

        /* Table Styling */
        .table-container {
            padding: 0 30px 30px;
            overflow-x: auto;
        }

        .smart-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .smart-table thead {
            background: var(--light-bg);
            position: sticky;
            top: 0;
        }

        .smart-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid var(--border-color);
            white-space: nowrap;
            cursor: pointer;
            user-select: none;
            position: relative;
        }

        .smart-table th .sort-indicator {
            margin-left: 5px;
            color: #999;
            font-size: 0.8em;
        }

        .smart-table td {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
        }

        .smart-table tbody tr {
            transition: background 0.2s;
        }

        .smart-table tbody tr:hover {
            background: rgba(67, 97, 238, 0.05);
        }

        /* Status Badges */
        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
        }

        .status-pending { background: #fff3cd; color: #856404; }
        .status-approved { background: #d4edda; color: #155724; }
        .status-rejected { background: #f8d7da; color: #721c24; }
        .status-visit-required { background: #cfe2ff; color: #084298; }
        .status-scheduled { background: #d1ecf1; color: #0c5460; }
        .status-in-progress { background: #fff3cd; color: #856404; }
        .status-completed { background: #d4edda; color: #155724; }

        /* Action Buttons */
        .action-cell {
            display: flex;
            gap: 8px;
            flex-wrap: nowrap;
        }

        .btn-action {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn-accept { background: #d4edda; color: #155724; }
        .btn-accept:hover { background: #c3e6cb; }
        .btn-reject { background: #f8d7da; color: #721c24; }
        .btn-reject:hover { background: #f5c6cb; }
        .btn-reschedule { background: #fff3cd; color: #856404; }
        .btn-reschedule:hover { background: #ffeaa7; }
        .btn-workflow { background: #cfe2ff; color: #084298; }
        .btn-workflow:hover { background: #b6d4fe; }
        .btn-invoice { background: #d1ecf1; color: #0c5460; }
        .btn-invoice:hover { background: #bee5eb; }

        /* Workflow Modal */
        .workflow-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .workflow-modal.active {
            display: flex;
        }

        .workflow-container {
            background: white;
            border-radius: 20px;
            width: 100%;
            width: 100%; /* ADD THIS */
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .workflow-header {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .workflow-header h2 {
            margin: 0;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-workflow {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .workflow-content {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
        }

        /* Horizontal Timeline */
        .workflow-timeline {
            display: flex;
            justify-content: space-between;
            position: relative;
            margin: 40px 0 60px;
            padding: 0 20px;
        }

        .timeline-connector {
            position: absolute;
            top: 40px;
            left: 50px;
            right: 50px;
            height: 4px;
            background: #e0e0e0;
            z-index: 1;
        }

        .workflow-step {
            position: relative;
            z-index: 2;
            text-align: center;
            min-width: 160px;
            max-width: 180px;
            flex: 1;
        }

        .step-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #e0e0e0;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            color: white;
            border: 4px solid white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .workflow-step.completed .step-circle {
            background: var(--success-color);
        }

        .workflow-step.active .step-circle {
            background: var(--primary-color);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(67, 97, 238, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(67, 97, 238, 0); }
            100% { box-shadow: 0 0 0 0 rgba(67, 97, 238, 0); }
        }

        .step-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 1rem;
            color: #333;
        }

        .step-subtitle {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 15px;
        }

        /* Step Details */
        .step-details {
            background: var(--light-bg);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            display: none;
        }

        .step-details.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .details-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .details-header h3 {
            margin: 0;
            color: var(--primary-color);
            font-size: 1.3rem;
        }

        .details-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .detail-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }

        .detail-card h4 {
            margin-top: 0;
            color: var(--secondary-color);
            font-size: 1rem;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .detail-item {
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }

        .detail-label {
            font-weight: 600;
            color: #555;
        }

        .detail-value {
            color: #333;
            text-align: right;
            max-width: 60%;
        }

        .photos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .photo-thumb {
            width: 100%;
            height: 80px;
            object-fit: cover;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .photo-thumb:hover {
            transform: scale(1.05);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .workflow-timeline {
                flex-wrap: wrap;
                justify-content: center;
                gap: 30px;
            }
            
            .workflow-step {
                min-width: 140px;
            }
            
            .timeline-connector {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .controls-section {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-filter-group {
                width: 100%;
            }
            
            .search-input {
                width: 100%;
            }
            
            .action-buttons {
                justify-content: center;
            }
            
            .smart-table {
                font-size: 0.9rem;
            }
            
            .action-cell {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
         <div class="container" id="workflowNavigation">
    <a href="./ManageBooking-nodecontent.html" target="_blank" class="btn btn-primary" id="workflowPresentationBtn">
        <i class="fas fa-calculator me-2"></i>Go back to  Step Node Presentation Workflow
    </a>
</div>
        <!-- Dashboard Header -->
        <div class="dashboard-header">
            <h1>
                <i class="fas fa-broom"></i>
                Cleaning Service – Smart Booking Manager (Canada)
            </h1>
            <p class="mb-0 mt-2 opacity-90">Manage, track, and monitor all cleaning service bookings</p>
        </div>

        <!-- Stats Cards -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-icon" style="background: var(--primary-color);">
                    <i class="fas fa-calendar-alt"></i>
                </div>
                <div class="stat-content">
                    <h3 id="totalBookings">0</h3>
                    <p>Total Bookings</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: #28a745;">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-content">
                    <h3 id="pendingBookings">0</h3>
                    <p>Pending Review</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: #ffc107;">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-content">
                    <h3 id="inProgress">0</h3>
                    <p>In Progress</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: #17a2b8;">
                    <i class="fas fa-dollar-sign"></i>
                </div>
                <div class="stat-content">
                    <h3 id="revenue">$0</h3>
                    <p>Estimated Revenue</p>
                </div>
            </div>
        </div>

        <!-- Controls Section -->
        <div class="controls-section">
            <div class="column-visibility">
                <button class="column-toggle-btn" id="toggleColumnsBtn">
                    <i class="fas fa-columns"></i>
                    Show/Hide Columns
                </button>
                <div class="column-checkboxes" id="columnCheckboxes">
                    <div class="column-option">
                        <input type="checkbox" id="col-id" checked data-column="0">
                        <label for="col-id">Booking ID</label>
                    </div>
                    <div class="column-option">
                        <input type="checkbox" id="col-client" checked data-column="1">
                        <label for="col-client">Client</label>
                    </div>
                    <div class="column-option">
                        <input type="checkbox" id="col-service" checked data-column="2">
                        <label for="col-service">Service</label>
                    </div>
                    <div class="column-option">
                        <input type="checkbox" id="col-type" checked data-column="3">
                        <label for="col-type">Type of Clean</label>
                    </div>
                    <div class="column-option">
                        <input type="checkbox" id="col-date" checked data-column="4">
                        <label for="col-date">Date/Time</label>
                    </div>
                    <div class="column-option">
                        <input type="checkbox" id="col-location" checked data-column="5">
                        <label for="col-location">Location</label>
                    </div>
                    <div class="column-option">
                        <input type="checkbox" id="col-address" checked data-column="6">
                        <label for="col-address">Full Address</label>
                    </div>
                    <div class="column-option">
                        <input type="checkbox" id="col-invoice" checked data-column="7">
                        <label for="col-invoice">Est. Invoice</label>
                    </div>
                    <div class="column-option">
                        <input type="checkbox" id="col-notes" checked data-column="8">
                        <label for="col-notes">Notes</label>
                    </div>
                    <div class="column-option">
                        <input type="checkbox" id="col-status" checked data-column="9">
                        <label for="col-status">Status</label>
                    </div>
                    <div class="column-option">
                        <input type="checkbox" id="col-onsite" checked data-column="10">
                        <label for="col-onsite">On-site Visit</label>
                    </div>
                    <div class="column-option">
                        <input type="checkbox" id="col-deposit" checked data-column="11">
                        <label for="col-deposit">Deposit</label>
                    </div>
                </div>
            </div>

            <div class="search-filter-group">
                <input type="text" class="search-input" id="searchInput" placeholder="Search client, service, location...">
                <select class="filter-select" id="statusFilter">
                    <option value="">All Status</option>
                    <option value="Pending">Pending Review</option>
                    <option value="Approved">Approved</option>
                    <option value="Rejected">Rejected</option>
                    <option value="Visit Required">Visit Required</option>
                    <option value="Scheduled">Scheduled</option>
                    <option value="In Progress">In Progress</option>
                    <option value="Completed">Completed</option>
                </select>
                <select class="filter-select" id="serviceFilter">
                    <option value="">All Services</option>
                    <option value="Maintenance Clean">Maintenance Clean</option>
                    <option value="Deep Clean">Deep Clean</option>
                    <option value="Move-Out Clean">Move-Out Clean</option>
                    <option value="Steam Clean">Steam Clean</option>
                </select>
                <input type="date" class="filter-select" id="dateFilter">
            </div>

            <div class="action-buttons">
                <button class="btn-custom btn-success-custom" id="exportBtn">
                    <i class="fas fa-file-export"></i> Export CSV
                </button>
                <button class="btn-custom btn-primary-custom" id="refreshBtn">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
        </div>

        <!-- Main Table -->
        <div class="table-container">
            <table class="smart-table" id="bookingTable">
                <thead>
                    <tr>
                        <th data-sort="id">Booking ID <span class="sort-indicator">↕</span></th>
                        <th data-sort="client">Client <span class="sort-indicator">↕</span></th>
                        <th data-sort="service">Service <span class="sort-indicator">↕</span></th>
                        <th data-sort="cleanType">Type of Clean <span class="sort-indicator">↕</span></th>
                        <th data-sort="date">Date/Time <span class="sort-indicator">↕</span></th>
                        <th data-sort="location">Location <span class="sort-indicator">↕</span></th>
                        <th data-sort="address">Full Address <span class="sort-indicator">↕</span></th>
                        <th data-sort="invoice">Est. Invoice <span class="sort-indicator">↕</span></th>
                        <th data-sort="notes">Notes <span class="sort-indicator">↕</span></th>
                        <th data-sort="status">Status <span class="sort-indicator">↕</span></th>
                        <th data-sort="onsite">On-site Visit <span class="sort-indicator">↕</span></th>
                        <th data-sort="deposit">Deposit <span class="sort-indicator">↕</span></th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Data will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Workflow Modal -->
    <div class="workflow-modal" id="workflowModal">
        <div class="workflow-container">
            <div class="workflow-header">
                <h2><i class="fas fa-project-diagram"></i> Cleaning Service Workflow Monitor</h2>
                <button class="close-workflow" id="closeWorkflowBtn">&times;</button>
            </div>
            <div class="workflow-content">
                <!-- Booking info -->
                <div id="workflowBookingInfo"></div>
                
                <!-- Timeline -->
                <div class="workflow-timeline" id="workflowTimeline">
                    <div class="timeline-connector"></div>
                    <!-- Steps will be dynamically inserted here -->
                </div>
                
                <!-- Step Details -->
                <div class="step-details" id="stepDetails">
                    <div class="details-header">
                        <h3 id="stepDetailsTitle">Step Details</h3>
                        <button class="btn-custom btn-primary-custom" id="closeDetailsBtn">
                            <i class="fas fa-times"></i> Close Details
                        </button>
                    </div>
                    <div class="details-content" id="stepDetailsContent">
                        <!-- Step details will be dynamically inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap Modals for Actions -->
    <div class="modal fade" id="invoiceModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Estimated Invoice</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="invoiceModalBody"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-success">Confirm Invoice</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Sample data based on your documents
        const bookings = [
            {
                id: "BK-2025-00014",
                client: "Maria Santos",
                contact: "+63 912 345 6789",
                service: "Home Cleaning",
                cleanType: "Steam Clean, Maintenance Clean",
                date: "2025-11-10T09:00:00",
                location: "Canada City",
                address: "25 Jupiter St., Canada City",
                invoice: 2850,
                currency: "CAD",
                notes: "Full house spring clean with balcony",
                status: "Pending Review",
                onsiteVisit: "No",
                deposit: "Optional",
                cleaningTypes: ["Steam Clean", "Maintenance Clean"],
                optionalTasks: ["Clean balcony", "Wipe exterior windows"],
                serviceItems: [
                    { name: "Large Room", price: 1200, qty: 2 },
                    { name: "Regular Room", price: 60, qty: 3 }
                ],
                currentStep: "Step 1"
            },
            {
                id: "BK-2025-00015",
                client: "John Reyes",
                contact: "+63 917 111 2222",
                service: "Move-Out Cleaning",
                cleanType: "Move-Out Clean",
                date: "2025-11-12T10:30:00",
                location: "Brgy. 77 Main",
                address: "Brgy. 77 Main St., Metro City",
                invoice: 7500,
                currency: "CAD",
                notes: "End-of-lease deep clean for 3-bedroom house",
                status: "Visit Required",
                onsiteVisit: "Yes",
                deposit: "Required",
                cleaningTypes: ["Move-Out Clean"],
                optionalTasks: ["Oven deep cleaning", "Mold removal"],
                houseSize: "Medium",
                squareFootage: 2300,
                currentStep: "Step 3"
            },
            {
                id: "BK-2025-00016",
                client: "Claire Dela Cruz",
                contact: "+63 905 777 4422",
                service: "Apartment Cleaning",
                cleanType: "Deep Clean",
                date: "2025-11-15T13:00:00",
                location: "Maple Condo",
                address: "Unit 5C Maple Condo, Downtown",
                invoice: 4200,
                currency: "CAD",
                notes: "Deep cleaning for neglected apartment",
                status: "Approved",
                onsiteVisit: "No",
                deposit: "Waived",
                cleaningTypes: ["Deep Clean"],
                optionalTasks: ["Pet area sanitization"],
                deepCleanTasks: ["Baseboards cleaning", "Deep scrubbing", "Inside cabinets"],
                currentStep: "Step 4"
            },
            {
                id: "BK-2025-00017",
                client: "Sarah Johnson",
                contact: "+1 416 555 1234",
                service: "Commercial Cleaning",
                cleanType: "Maintenance Clean",
                date: "2025-11-18T08:00:00",
                location: "Toronto, ON",
                address: "25 Maple Street, Toronto, ON",
                invoice: 2200,
                currency: "CAD",
                notes: "Weekly office maintenance",
                status: "Scheduled",
                onsiteVisit: "Yes (Auto)",
                deposit: "Waived (Commercial)",
                cleaningTypes: ["Maintenance Clean"],
                serviceType: "Commercial",
                minHours: 6,
                rate: 44,
                currentStep: "Step 8"
            },
            {
                id: "BK-2025-00018",
                client: "Ethan Brown",
                contact: "+1 613 555 7890",
                service: "Steam Cleaning",
                cleanType: "Steam Clean",
                date: "2025-11-20T11:00:00",
                location: "Ottawa, ON",
                address: "45 Rideau Street, Ottawa, ON",
                invoice: 1800,
                currency: "CAD",
                notes: "Carpet and couch steam cleaning",
                status: "In Progress",
                onsiteVisit: "No",
                deposit: "Paid",
                cleaningTypes: ["Steam Clean"],
                serviceItems: [
                    { name: "Couch", price: 100, qty: 1 },
                    { name: "Large Room", price: 75, qty: 3 },
                    { name: "Stairs", price: 5, qty: 8 }
                ],
                currentStep: "Step 10"
            },
            {
                id: "BK-2025-00019",
                client: "Olivia Chen",
                contact: "+1 403 555 4567",
                service: "Move-Out Cleaning",
                cleanType: "Move-Out Clean",
                date: "2025-11-22T14:00:00",
                location: "Calgary, AB",
                address: "321 Centre Street NW, Calgary, AB",
                invoice: 3100,
                currency: "CAD",
                notes: "Complete move-out clean for condo",
                status: "Completed",
                onsiteVisit: "Yes",
                deposit: "Optional",
                cleaningTypes: ["Move-Out Clean"],
                optionalTasks: ["Clean all windows", "Empty fridge"],
                houseSize: "Small",
                squareFootage: 1800,
                currentStep: "Step 12"
            }
        ];

        // Workflow steps with detailed data from your documents
        const workflowSteps = [
            {
                step: 1,
                title: "Client Mobile App: Estimation & Booking",
                subtitle: "Service selection & initial data collection",
                key: "pending_review",
                data: {
                    purpose: "Initial booking interface where client selects services, reviews pricing, adds optional tasks",
                    clientInfo: ["Full Name", "Mobile Number", "Complete Address"],
                    cleaningTypes: ["Steam Clean", "Deep Clean", "Move-Out Clean", "Maintenance Clean"],
                    outputs: ["Client info", "Selected cleaning types", "Optional tasks", "On-site visit request", "Estimated total"]
                }
            },
            {
                step: 2,
                title: "Supervisor: Manage Booking Review",
                subtitle: "Review client submission & schedule visits",
                key: "approved",
                data: {
                    purpose: "Supervisor reviews all Step 1 data, makes adjustments, schedules site visits if needed",
                    displayedInfo: ["Client Information", "Cleaning Types Selected", "Service Items", "Optional Tasks", "Estimate Summary"],
                    actions: ["Approve Booking", "Reject/Request Revision", "Schedule On-Site Visit", "Edit Estimate"],
                    notes: "Commercial Maintenance Clean always requires on-site visit"
                }
            },
            {
                step: 3,
                title: "Supervisor Site Visit & Report",
                subtitle: "Property inspection & adjusted estimation",
                key: "awaiting_visit",
                data: {
                    purpose: "Inspect property, verify client data, adjust estimates based on actual conditions",
                    activities: ["Property inspection", "Photo documentation", "Estimate adjustment", "Recurrence flagging"],
                    outputs: ["Adjusted estimation", "Site visit notes", "Uploaded photos", "Recurrence info (Grey Line)"],
                    features: ["Grey Line feature for recurrence visualization"]
                }
            },
            {
                step: 4,
                title: "Manager: Review & Finalize Quotation",
                subtitle: "Final approval & quotation generation",
                key: "quotation_sent",
                data: {
                    purpose: "Manager reviews supervisor report, finalizes costs, adds upsells, generates official quotation",
                    sections: ["Client & Booking Info", "Supervisor Report", "Estimation Breakdown", "Task List", "Upselling Options"],
                    actions: ["Generate Quotation", "Request Revision", "Reject Booking"],
                    features: ["Grey Line recurrence indicator"]
                }
            },
            {
                step: 5,
                title: "Client: Review & Approve Quotation",
                subtitle: "Client approval with digital booklet",
                key: "quotation_approved",
                data: {
                    purpose: "Client reviews manager-approved quotation, accesses digital booklet, approves or requests revision",
                    features: ["Service Breakdown Card", "Total Amount Card", "Digital Booklet", "Client Actions"],
                    digitalBooklet: ["Client Information", "Service Details", "Original Estimate", "Supervisor Adjusted Estimate", "Manager Approved Quotation"],
                    actions: ["Approve Quotation", "Decline/Request Revision"]
                }
            },
            {
                step: 6,
                title: "Client: Pay Invoice",
                subtitle: "In-app payment with deposit options",
                key: "quotation_paid",
                data: {
                    purpose: "Allows client to complete financial transaction for booked services",
                    paymentMethods: ["PayPal", "Debit Card", "Credit Card"],
                    depositRules: ["Residential: optional deposit/waiver", "Commercial: deposit not required"],
                    features: ["Invoice Summary Card", "Deposit Option", "Pay Now Button"]
                }
            },
            {
                step: 7,
                title: "System: Auto-Create Appointment",
                subtitle: "Appointment details & cleaner task list",
                key: "appointment_ready",
                data: {
                    purpose: "Shows confirmed appointment details after payment, allows client to track service",
                    displayedInfo: ["Appointment ID", "Client Info", "Service Package", "Assigned Cleaner", "Task List"],
                    features: ["Task completion tracking", "Cleaner photos/results", "Add notes for cleaner", "Calendar view"]
                }
            },
            {
                step: 8,
                title: "Manager: Assign Cleaner(s)",
                subtitle: "Cleaner assignment & scheduling",
                key: "scheduled",
                data: {
                    purpose: "Manager assigns cleaner or team to paid appointments, updates status to Scheduled",
                    criteria: ["Only appointments with 'Paid' status appear", "Single or team assignment"],
                    notifications: ["Client notification with cleaner details", "Cleaner notification with task details"],
                    features: ["Cleaner availability check", "Team assignment option"]
                }
            },
            {
                step: 9,
                title: "Cleaner: Accept Appointment",
                subtitle: "Cleaner acceptance & equipment verification",
                key: "in_progress",
                data: {
                    purpose: "Cleaner views assigned appointments, verifies mandatory equipment, accepts appointment",
                    rules: ["Cleaners cannot decline appointments", "Equipment checklist mandatory for Steam cleaning"],
                    features: ["Appointment Cards", "Task List (read-only)", "Equipment Checklist", "Accept Button"],
                    workflow: "Acceptance updates status to in_progress, triggers notifications"
                }
            },
            {
                step: 10,
                title: "Cleaner: View Assignment & Begin Service",
                subtitle: "Full assignment review & service start",
                key: "in_progress",
                data: {
                    purpose: "Cleaner reviews complete appointment details, confirms equipment, starts service",
                    displayedInfo: ["Appointment Summary", "Client Information", "Location Details", "Service Details", "Full Task List"],
                    requirements: ["Mandatory equipment checklist", "Cannot start without all equipment checked"],
                    actions: ["Contact Client", "Contact Manager", "Navigation", "Start Service"]
                }
            },
            {
                step: 11,
                title: "Manager: Post-Cleaning Verification",
                subtitle: "Task completion review & internal notes",
                key: "service_done",
                data: {
                    purpose: "Manager reviews completed cleaning appointments, verifies task completion, finalizes workflow",
                    displayedInfo: ["Appointment Overview", "Task Completion Table", "Internal Notes", "Photos"],
                    actions: ["Service Complete", "Create Final Invoice Summary", "View Task Photos"],
                    invoicingRules: ["Residential: weekly invoices", "Commercial: monthly invoices"]
                }
            },
            {
                step: 12,
                title: "Finalize Booking & Sync to QuickBooks",
                subtitle: "Invoice sync & booking closure",
                key: "closed",
                data: {
                    purpose: "Final step to close booking, sync invoice to QuickBooks, notify client",
                    activities: ["Push invoice to QuickBooks", "Mark booking as closed", "Send thank-you notification", "Trigger follow-up actions"],
                    outputs: ["Invoice synced to accounting", "Booking status updated", "Client notifications sent", "Audit trail maintained"],
                    features: ["Final Invoice Table", "QuickBooks integration", "Follow-up survey/marketing", "KPI tracking"]
                }
            }
        ];

        // DOM Elements
        const tableBody = document.getElementById('tableBody');
        const workflowModal = document.getElementById('workflowModal');
        const workflowTimeline = document.getElementById('workflowTimeline');
        const stepDetails = document.getElementById('stepDetails');
        const stepDetailsContent = document.getElementById('stepDetailsContent');
        const stepDetailsTitle = document.getElementById('stepDetailsTitle');
        const closeWorkflowBtn = document.getElementById('closeWorkflowBtn');
        const closeDetailsBtn = document.getElementById('closeDetailsBtn');
        const workflowBookingInfo = document.getElementById('workflowBookingInfo');
        const searchInput = document.getElementById('searchInput');
        const statusFilter = document.getElementById('statusFilter');
        const serviceFilter = document.getElementById('serviceFilter');
        const dateFilter = document.getElementById('dateFilter');
        const refreshBtn = document.getElementById('refreshBtn');
        const exportBtn = document.getElementById('exportBtn');
        const toggleColumnsBtn = document.getElementById('toggleColumnsBtn');
        const columnCheckboxes = document.getElementById('columnCheckboxes');
        const invoiceModal = new bootstrap.Modal(document.getElementById('invoiceModal'));
        const invoiceModalBody = document.getElementById('invoiceModalBody');

        // Statistics elements
        const totalBookingsEl = document.getElementById('totalBookings');
        const pendingBookingsEl = document.getElementById('pendingBookings');
        const inProgressEl = document.getElementById('inProgress');
        const revenueEl = document.getElementById('revenue');

        // State variables
        let currentBooking = null;
        let sortState = { key: 'id', direction: 'asc' };
        let filteredBookings = [...bookings];

        // Initialize
        function init() {
            renderTable();
            updateStats();
            setupEventListeners();
            setupColumnVisibility();
        }

        // Update statistics
        function updateStats() {
            const total = bookings.length;
            const pending = bookings.filter(b => b.status === 'Pending Review').length;
            const inProgressCount = bookings.filter(b => b.status === 'In Progress' || b.status === 'Scheduled').length;
            const revenueTotal = bookings.reduce((sum, b) => sum + b.invoice, 0);
            
            totalBookingsEl.textContent = total;
            pendingBookingsEl.textContent = pending;
            inProgressEl.textContent = inProgressCount;
            revenueEl.textContent = `$${revenueTotal.toLocaleString()}`;
        }

        // Render main table
        function renderTable(data = filteredBookings) {
            tableBody.innerHTML = '';
            
            data.forEach(booking => {
                const row = document.createElement('tr');
                
                // Format date
                const date = new Date(booking.date);
                const formattedDate = date.toLocaleDateString('en-CA', {
                    weekday: 'short',
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                // Status badge
                let statusClass = '';
                if (booking.status.includes('Pending')) statusClass = 'status-pending';
                else if (booking.status.includes('Approved')) statusClass = 'status-approved';
                else if (booking.status.includes('Rejected')) statusClass = 'status-rejected';
                else if (booking.status.includes('Visit')) statusClass = 'status-visit-required';
                else if (booking.status.includes('Scheduled')) statusClass = 'status-scheduled';
                else if (booking.status.includes('Progress')) statusClass = 'status-in-progress';
                else if (booking.status.includes('Completed')) statusClass = 'status-completed';
                
                row.innerHTML = `
                    <td><strong>${booking.id}</strong></td>
                    <td>
                        <div>${booking.client}</div>
                        <small class="text-muted">${booking.contact}</small>
                    </td>
                    <td>${booking.service}</td>
                    <td>${booking.cleanType}</td>
                    <td>${formattedDate}</td>
                    <td>${booking.location}</td>
                    <td>${booking.address}</td>
                    <td>
                        <strong>${booking.currency} ${booking.invoice.toLocaleString()}</strong>
                        <button class="btn-action btn-invoice view-invoice" data-id="${booking.id}" title="View Invoice">
                            <i class="fas fa-file-invoice-dollar"></i>
                        </button>
                    </td>
                    <td>${booking.notes}</td>
                    <td><span class="status-badge ${statusClass}">${booking.status}</span></td>
                    <td>${booking.onsiteVisit}</td>
                    <td>${booking.deposit}</td>
                    <td class="action-cell">
                        <button class="btn-action btn-accept" data-id="${booking.id}" title="Accept">
                            <i class="fas fa-check"></i>
                        </button>
                        <button class="btn-action btn-reject" data-id="${booking.id}" title="Reject">
                            <i class="fas fa-times"></i>
                        </button>
                        <button class="btn-action btn-reschedule" data-id="${booking.id}" title="Reschedule">
                            <i class="fas fa-calendar-alt"></i>
                        </button>
                        <button class="btn-action btn-workflow view-workflow" data-id="${booking.id}" title="View Workflow">
                            <i class="fas fa-project-diagram"></i>
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // Setup column visibility controls
        function setupColumnVisibility() {
            const checkboxes = columnCheckboxes.querySelectorAll('input[type="checkbox"]');
            const tableHeaders = document.querySelectorAll('#bookingTable thead th');
            const tableCells = document.querySelectorAll('#bookingTable tbody td');
            
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const columnIndex = parseInt(this.dataset.column);
                    const isVisible = this.checked;
                    
                    // Show/hide table header
                    tableHeaders[columnIndex].style.display = isVisible ? '' : 'none';
                    
                    // Show/hide table cells in this column
                    const rows = document.querySelectorAll('#bookingTable tbody tr');
                    rows.forEach(row => {
                        const cell = row.cells[columnIndex];
                        if (cell) cell.style.display = isVisible ? '' : 'none';
                    });
                });
                
                // Initialize visibility
                const columnIndex = parseInt(checkbox.dataset.column);
                const isVisible = checkbox.checked;
                tableHeaders[columnIndex].style.display = isVisible ? '' : 'none';
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Column visibility toggle
            toggleColumnsBtn.addEventListener('click', () => {
                columnCheckboxes.classList.toggle('show');
            });
            
            // Close column dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!toggleColumnsBtn.contains(e.target) && !columnCheckboxes.contains(e.target)) {
                    columnCheckboxes.classList.remove('show');
                }
            });
            
            // Search and filter
            searchInput.addEventListener('input', filterTable);
            statusFilter.addEventListener('change', filterTable);
            serviceFilter.addEventListener('change', filterTable);
            dateFilter.addEventListener('change', filterTable);
            
            // Refresh button
            refreshBtn.addEventListener('click', () => {
                filteredBookings = [...bookings];
                renderTable();
                updateStats();
                searchInput.value = '';
                statusFilter.value = '';
                serviceFilter.value = '';
                dateFilter.value = '';
            });
            
            // Export button
            exportBtn.addEventListener('click', exportToCSV);
            
            // Close workflow modal
            closeWorkflowBtn.addEventListener('click', () => {
                workflowModal.classList.remove('active');
            });
            
            // Close details button
            closeDetailsBtn.addEventListener('click', () => {
                stepDetails.classList.remove('active');
            });
            
            // Table sorting
            document.querySelectorAll('#bookingTable th[data-sort]').forEach(th => {
                th.addEventListener('click', () => {
                    const key = th.dataset.sort;
                    sortTable(key);
                });
            });
            
            // Table body click events (delegation)
            tableBody.addEventListener('click', handleTableClick);
            
            // Close modal when clicking outside
            workflowModal.addEventListener('click', (e) => {
                if (e.target === workflowModal) {
                    workflowModal.classList.remove('active');
                }
            });
        }

        // Filter table based on filters
        function filterTable() {
            const searchTerm = searchInput.value.toLowerCase();
            const statusTerm = statusFilter.value;
            const serviceTerm = serviceFilter.value;
            const dateTerm = dateFilter.value;
            
            filteredBookings = bookings.filter(booking => {
                // Search term
                const matchesSearch = !searchTerm || 
                    booking.client.toLowerCase().includes(searchTerm) ||
                    booking.service.toLowerCase().includes(searchTerm) ||
                    booking.location.toLowerCase().includes(searchTerm) ||
                    booking.address.toLowerCase().includes(searchTerm) ||
                    booking.id.toLowerCase().includes(searchTerm);
                
                // Status filter
                const matchesStatus = !statusTerm || 
                    booking.status === statusTerm ||
                    (statusTerm === 'Pending' && booking.status.includes('Pending')) ||
                    (statusTerm === 'In Progress' && (booking.status.includes('Progress') || booking.status.includes('Scheduled')));
                
                // Service filter
                const matchesService = !serviceTerm || 
                    booking.cleanType.includes(serviceTerm);
                
                // Date filter
                let matchesDate = true;
                if (dateTerm) {
                    const bookingDate = new Date(booking.date).toISOString().split('T')[0];
                    matchesDate = bookingDate === dateTerm;
                }
                
                return matchesSearch && matchesStatus && matchesService && matchesDate;
            });
            
            renderTable();
        }

        // Sort table
        function sortTable(key) {
            const direction = sortState.key === key ? 
                (sortState.direction === 'asc' ? 'desc' : 'asc') : 'asc';
            
            sortState = { key, direction };
            
            filteredBookings.sort((a, b) => {
                let aVal = a[key];
                let bVal = b[key];
                
                if (key === 'date') {
                    aVal = new Date(aVal);
                    bVal = new Date(bVal);
                }
                
                if (key === 'invoice') {
                    aVal = parseFloat(aVal);
                    bVal = parseFloat(bVal);
                }
                
                if (typeof aVal === 'string') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                }
                
                if (aVal < bVal) return direction === 'asc' ? -1 : 1;
                if (aVal > bVal) return direction === 'asc' ? 1 : -1;
                return 0;
            });
            
            // Update sort indicators
            document.querySelectorAll('#bookingTable th .sort-indicator').forEach(indicator => {
                indicator.textContent = '↕';
            });
            
            const currentTh = document.querySelector(`#bookingTable th[data-sort="${key}"] .sort-indicator`);
            currentTh.textContent = direction === 'asc' ? '↑' : '↓';
            
            renderTable();
        }

        // Handle table click events
        function handleTableClick(e) {
            const target = e.target;
            const button = target.closest('button');
            
            if (!button) return;
            
            const bookingId = button.dataset.id;
            const booking = bookings.find(b => b.id === bookingId);
            
            if (!booking) return;
            
            if (button.classList.contains('view-workflow')) {
                currentBooking = booking;
                showWorkflowModal(booking);
            }
            else if (button.classList.contains('view-invoice')) {
                showInvoiceModal(booking);
            }
            else if (button.classList.contains('btn-accept')) {
                booking.status = 'Approved';
                renderTable();
                updateStats();
                alert(`Booking ${bookingId} approved!`);
            }
            else if (button.classList.contains('btn-reject')) {
                booking.status = 'Rejected';
                renderTable();
                updateStats();
                alert(`Booking ${bookingId} rejected!`);
            }
            else if (button.classList.contains('btn-reschedule')) {
                const newDate = prompt('Enter new date and time (YYYY-MM-DDTHH:MM):', booking.date.slice(0, 16));
                if (newDate) {
                    booking.date = newDate + ':00';
                    booking.status = 'Pending Review';
                    renderTable();
                    alert(`Booking ${bookingId} rescheduled!`);
                }
            }
        }

        // Show workflow modal
        function showWorkflowModal(booking) {
            // Set booking info
            workflowBookingInfo.innerHTML = `
                <div class="detail-card">
                    <h4>Booking Information</h4>
                    <div class="detail-item">
                        <span class="detail-label">Booking ID:</span>
                        <span class="detail-value">${booking.id}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Client:</span>
                        <span class="detail-value">${booking.client} (${booking.contact})</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Service:</span>
                        <span class="detail-value">${booking.service} - ${booking.cleanType}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Location:</span>
                        <span class="detail-value">${booking.address}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Current Status:</span>
                        <span class="detail-value"><span class="status-badge status-${booking.status.includes('Pending') ? 'pending' : 'approved'}">${booking.status}</span></span>
                    </div>
                </div>
            `;
            
            // Clear timeline
            workflowTimeline.innerHTML = '<div class="timeline-connector"></div>';
            
            // Add steps to timeline
            workflowSteps.forEach((step, index) => {
                const stepElement = document.createElement('div');
                stepElement.className = 'workflow-step';
                
                // Determine if step is completed or active
                const currentStepIndex = workflowSteps.findIndex(s => s.key === getStepKeyFromStatus(booking.status));
                if (index < currentStepIndex) {
                    stepElement.classList.add('completed');
                } else if (index === currentStepIndex) {
                    stepElement.classList.add('active');
                }
                
                stepElement.innerHTML = `
                    <div class="step-circle">${step.step}</div>
                    <div class="step-title">${step.title}</div>
                    <div class="step-subtitle">${step.subtitle}</div>
                `;
                
                // Add click event to show step details
                stepElement.addEventListener('click', () => showStepDetails(step, booking));
                
                workflowTimeline.appendChild(stepElement);
            });
            
            // Show modal
            workflowModal.classList.add('active');
            stepDetails.classList.remove('active');
        }

        // Show step details
        function showStepDetails(step, booking) {
            stepDetailsTitle.textContent = `${step.title} (Step ${step.step})`;
            
            let detailsHTML = '';
            
            // Generate details based on step
            switch(step.step) {
                case 1:
                    detailsHTML = generateStep1Details(booking);
                    break;
                case 2:
                    detailsHTML = generateStep2Details(booking);
                    break;
                case 3:
                    detailsHTML = generateStep3Details(booking);
                    break;
                case 4:
                    detailsHTML = generateStep4Details(booking);
                    break;
                case 5:
                    detailsHTML = generateStep5Details(booking);
                    break;
                case 6:
                    detailsHTML = generateStep6Details(booking);
                    break;
                case 7:
                    detailsHTML = generateStep7Details(booking);
                    break;
                case 8:
                    detailsHTML = generateStep8Details(booking);
                    break;
                case 9:
                    detailsHTML = generateStep9Details(booking);
                    break;
                case 10:
                    detailsHTML = generateStep10Details(booking);
                    break;
                case 11:
                    detailsHTML = generateStep11Details(booking);
                    break;
                case 12:
                    detailsHTML = generateStep12Details(booking);
                    break;
                default:
                    detailsHTML = `<p>Details for ${step.title}</p>`;
            }
            
            stepDetailsContent.innerHTML = detailsHTML;
            stepDetails.classList.add('active');
            
            // Scroll to details
            stepDetails.scrollIntoView({ behavior: 'smooth' });
        }

        // Generate step details functions
        // Replace the existing generateStep1Details function with this comprehensive version:







 //// // // // // // // // // // // // // // // // // // // // // //  steps pipeline workflow   // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // // 




function generateStep1Details(booking) {
    return `
        <div class="detail-card">
            <h4><i class="fas fa-eye me-2"></i> SUPERVISOR VIEW: STEP 1 CLIENT SUBMISSION</h4>
            <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                <strong>Supervisor Perspective:</strong> You are reviewing the client's initial booking submission. You can view all data entered by the client and make adjustments if needed.
            </div>
        </div>
        
        <div class="detail-card">
            <h4><i class="fas fa-user-circle me-2"></i> CLIENT PROFILE INFORMATION</h4>
            <div class="detail-item">
                <span class="detail-label">Client ID:</span>
                <span class="detail-value">${booking.client.replace(/\s+/g, '').toUpperCase()}-${new Date().getFullYear()}</span>
            </div>
            <div class="detail-item">
                <span class="detail-label">Full Name:</span>
                <span class="detail-value"><strong>${booking.client}</strong></span>
            </div>
            <div class="detail-item">
                <span class="detail-label">Mobile Number:</span>
                <span class="detail-value">
                    ${booking.contact}
                    <button class="btn btn-sm btn-outline-primary ms-2" title="Call client">
                        <i class="fas fa-phone"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-success ms-1" title="Send SMS">
                        <i class="fas fa-sms"></i>
                    </button>
                </span>
            </div>
            <div class="detail-item">
                <span class="detail-label">Service Address:</span>
                <span class="detail-value">
                    ${booking.address}
                    <button class="btn btn-sm btn-outline-info ms-2" title="View on Map">
                        <i class="fas fa-map-marker-alt"></i>
                    </button>
                </span>
            </div>
            <div class="detail-item">
                <span class="detail-label">Client Type:</span>
                <span class="detail-value">
                    ${booking.serviceType === 'Commercial' ? 
                        '<span class="badge bg-danger">Commercial</span>' : 
                        '<span class="badge bg-primary">Residential</span>'}
                </span>
            </div>
        </div>
        
        <div class="detail-card">
            <h4><i class="fas fa-clipboard-check me-2"></i> CLEANING TYPE SELECTION REVIEW</h4>
            <div class="detail-item">
                <span class="detail-label">Selected Cleaning Types:</span>
                <span class="detail-value">
                    ${booking.cleaningTypes?.map(type => `
                        <span class="badge bg-secondary me-1">${type}</span>
                    `).join('') || 'No types selected'}
                </span>
            </div>
            
            <div class="mt-3 p-3 bg-light border rounded">
                <h6><i class="fas fa-check-circle text-success me-2"></i>Validation Status</h6>
                <div class="detail-item">
                    <span class="detail-label">Selection Logic:</span>
                    <span class="detail-value">
                        ${booking.cleaningTypes?.length > 1 ? 
                            '<span class="badge bg-success"><i class="fas fa-check me-1"></i>Multiple types merged</span>' : 
                            '<span class="badge bg-info"><i class="fas fa-check me-1"></i>Single type selected</span>'}
                    </span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Compatibility Check:</span>
                    <span class="detail-value">
                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Types compatible</span>
                    </span>
                </div>
                
                <div class="mt-3">
                    <button class="btn btn-sm btn-outline-warning">
                        <i class="fas fa-edit me-1"></i> Adjust Cleaning Types
                    </button>
                    <small class="text-muted ms-2">Add/remove cleaning types based on property assessment</small>
                </div>
            </div>
        </div>
        
        <div class="detail-card">
            <h4><i class="fas fa-calculator me-2"></i> PRICING CALCULATIONS & VALIDATION</h4>
            
            <!-- Maintenance Clean Pricing -->
            ${booking.cleaningTypes?.includes('Maintenance Clean') ? `
            <div class="mb-3 p-3 border rounded">
                <h6 class="text-primary">Maintenance Clean Details</h6>
                <div class="row">
                    <div class="col-md-6">
                        <div class="detail-item">
                            <span class="detail-label">Rate Applied:</span>
                            <span class="detail-value">
                                ${booking.serviceType === 'Commercial' ? 
                                    '<strong>$44/hr</strong> (Commercial)' : 
                                    '<strong>$38/hr</strong> (Residential)'}
                            </span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Minimum Hours:</span>
                            <span class="detail-value">
                                ${booking.serviceType === 'Commercial' ? 
                                    '<strong>6 hrs</strong> (2 cleaners × 3 hrs)' : 
                                    '<strong>3 hrs</strong>'}
                            </span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="detail-item">
                            <span class="detail-label">On-site Visit:</span>
                            <span class="detail-value">
                                ${booking.serviceType === 'Commercial' ? 
                                    '<span class="badge bg-warning">Auto-required</span>' : 
                                    '<span class="badge bg-secondary">Client option</span>'}
                            </span>
                        </div>
                    </div>
                </div>
                <div class="mt-2">
                    <button class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-sliders-h me-1"></i> Adjust Hourly Rates
                    </button>
                </div>
            </div>
            ` : ''}
            
            <!-- Move-Out Clean Pricing -->
            ${booking.cleaningTypes?.includes('Move-Out Clean') ? `
            <div class="mb-3 p-3 border rounded">
                <h6 class="text-primary">Move-Out Clean Details</h6>
                <div class="detail-item">
                    <span class="detail-label">House Size:</span>
                    <span class="detail-value"><strong>${booking.houseSize || 'Not specified'}</strong></span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Square Footage:</span>
                    <span class="detail-value">
                        <strong>${booking.squareFootage || '0'}</strong> sqft
                        ${!booking.squareFootage ? 
                            '<span class="badge bg-danger ms-2"><i class="fas fa-exclamation-triangle me-1"></i>Missing</span>' : 
                            '<span class="badge bg-success ms-2"><i class="fas fa-check me-1"></i>Provided</span>'}
                    </span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Hourly Rate:</span>
                    <span class="detail-value"><strong>$50/hr</strong> (Default)</span>
                </div>
                <div class="mt-2">
                    <button class="btn btn-sm btn-outline-primary me-2">
                        <i class="fas fa-ruler-combined me-1"></i> Update Square Footage
                    </button>
                    <button class="btn btn-sm btn-outline-warning">
                        <i class="fas fa-dollar-sign me-1"></i> Adjust Hourly Rate
                    </button>
                </div>
            </div>
            ` : ''}
            
            <!-- Steam Clean Pricing -->
            ${booking.serviceItems && booking.serviceItems.length > 0 ? `
            <div class="mb-3 p-3 border rounded">
                <h6 class="text-primary">Steam Clean Items & Pricing</h6>
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Unit Price</th>
                                <th>Quantity</th>
                                <th>Total</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${booking.serviceItems.map(item => `
                            <tr>
                                <td>${item.name}</td>
                                <td>${booking.currency} ${item.price}</td>
                                <td>
                                    <div class="input-group input-group-sm" style="width: 120px;">
                                        <button class="btn btn-outline-secondary" type="button">-</button>
                                        <input type="number" class="form-control text-center" value="${item.qty}" min="1">
                                        <button class="btn btn-outline-secondary" type="button">+</button>
                                    </div>
                                </td>
                                <td><strong>${booking.currency} ${item.price * item.qty}</strong></td>
                                <td>
                                    <button class="btn btn-sm btn-outline-danger" title="Remove item">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                <div class="mt-2">
                    <button class="btn btn-sm btn-success me-2">
                        <i class="fas fa-plus me-1"></i> Add Service Item
                    </button>
                    <button class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-calculator me-1"></i> Recalculate Total
                    </button>
                </div>
            </div>
            ` : ''}
        </div>
        
        <div class="detail-card">
            <h4><i class="fas fa-tasks me-2"></i> OPTIONAL TASKS & SPECIAL INSTRUCTIONS</h4>
            ${booking.optionalTasks ? `
            <div class="mb-3">
                <strong>Client-Requested Tasks:</strong>
                <div class="mt-2">
                    ${booking.optionalTasks.map((task, index) => `
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="task${index}" checked>
                        <label class="form-check-label" for="task${index}">
                            ${task}
                        </label>
                        <div class="float-end">
                            <select class="form-select form-select-sm d-inline-block" style="width: 120px;">
                                <option>Include</option>
                                <option>Add-on Charge</option>
                                <option>Requires Quote</option>
                                <option>Exclude</option>
                            </select>
                        </div>
                    </div>
                    `).join('')}
                </div>
            </div>
            ` : '<p class="text-muted">No optional tasks specified by client</p>'}
            
            <div class="mt-3">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Add supervisor note or adjustment...">
                    <button class="btn btn-primary" type="button">
                        <i class="fas fa-plus"></i> Add Note
                    </button>
                </div>
                <small class="text-muted">Add internal notes about special requirements or adjustments needed</small>
            </div>
        </div>
        
        <div class="detail-card">
            <h4><i class="fas fa-file-invoice-dollar me-2"></i> ESTIMATE SUMMARY & APPROVAL</h4>
            <div class="row">
                <div class="col-md-8">
                    <div class="p-3 bg-light border rounded">
                        <div class="detail-item">
                            <span class="detail-label">Service Subtotal:</span>
                            <span class="detail-value">${booking.currency} ${booking.invoice.toLocaleString()}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Tax (5%):</span>
                            <span class="detail-value">${booking.currency} ${(booking.invoice * 0.05).toFixed(2)}</span>
                        </div>
                        ${booking.deposit === 'Paid' || booking.deposit === 'Required' ? `
                        <div class="detail-item">
                            <span class="detail-label">Deposit:</span>
                            <span class="detail-value">${booking.currency} 120.00</span>
                        </div>
                        ` : ''}
                        <div class="detail-item" style="border-top: 2px solid #dee2e6; padding-top: 10px; margin-top: 10px;">
                            <span class="detail-label"><strong>Grand Total:</strong></span>
                            <span class="detail-value"><strong>${booking.currency} ${(booking.invoice * 1.05).toLocaleString()}</strong></span>
                        </div>
                        
                        <div class="mt-3">
                            <div class="input-group input-group-sm" style="width: 200px;">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" value="${booking.invoice}" step="50">
                                <span class="input-group-text">.00</span>
                            </div>
                            <small class="text-muted">Adjust final estimate if needed</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="p-3 border rounded">
                        <h6>Supervisor Actions</h6>
                        <div class="d-grid gap-2">
                            <button class="btn btn-success">
                                <i class="fas fa-check-circle me-2"></i> Approve Estimate
                            </button>
                            <button class="btn btn-warning">
                                <i class="fas fa-edit me-2"></i> Request Revision
                            </button>
                            ${booking.onsiteVisit === 'Yes' ? `
                            <button class="btn btn-info">
                                <i class="fas fa-calendar-alt me-2"></i> Schedule Site Visit
                            </button>
                            ` : ''}
                            <button class="btn btn-danger">
                                <i class="fas fa-times-circle me-2"></i> Reject Booking
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="detail-card">
            <h4><i class="fas fa-cog me-2"></i> SUPERVISOR CONTROLS & WORKFLOW</h4>
            <div class="row">
                <div class="col-md-6">
                    <div class="p-3 border rounded h-100">
                        <h6>Booking Status</h6>
                        <div class="mb-3">
                            <select class="form-select">
                                <option ${booking.status === 'Pending Review' ? 'selected' : ''}>Pending Review</option>
                                <option ${booking.status === 'Approved' ? 'selected' : ''}>Approved</option>
                                <option ${booking.status === 'Visit Required' ? 'selected' : ''}>Visit Required</option>
                                <option ${booking.status === 'Rejected' ? 'selected' : ''}>Rejected</option>
                                <option>Needs Revision</option>
                            </select>
                        </div>
                        
                        <h6>On-site Visit Status</h6>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="siteVisitRequired" ${booking.onsiteVisit === 'Yes' ? 'checked' : ''}>
                                <label class="form-check-label" for="siteVisitRequired">
                                    Site Visit Required
                                </label>
                            </div>
                            ${booking.onsiteVisit === 'Yes' ? `
                            <div class="mt-2">
                                <input type="date" class="form-control form-control-sm" value="${new Date(booking.date).toISOString().split('T')[0]}">
                                <small class="text-muted">Schedule visit date</small>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="p-3 border rounded h-100">
                        <h6>Internal Notes & Comments</h6>
                        <textarea class="form-control" rows="4" placeholder="Add internal notes for the team..."></textarea>
                        <div class="mt-2">
                            <button class="btn btn-sm btn-outline-secondary">
                                <i class="fas fa-save me-1"></i> Save Notes
                            </button>
                            <button class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-paper-plane me-1"></i> Notify Client
                            </button>
                        </div>
                        
                        <div class="mt-3">
                            <h6>Data Validation</h6>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="validateAddress" checked>
                                <label class="form-check-label" for="validateAddress">
                                    Address verified
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="validateContact" ${booking.contact ? 'checked' : ''}>
                                <label class="form-check-label" for="validateContact">
                                    Contact information valid
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="validateScope" ${booking.cleaningTypes?.length > 0 ? 'checked' : ''}>
                                <label class="form-check-label" for="validateScope">
                                    Scope of work clear
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="detail-card bg-light">
            <h4><i class="fas fa-history me-2"></i> AUDIT TRAIL & NEXT STEPS</h4>
            <div class="detail-item">
                <span class="detail-label">Submission Date:</span>
                <span class="detail-value">${new Date(booking.date).toLocaleString()}</span>
            </div>
            <div class="detail-item">
                <span class="detail-label">Last Updated:</span>
                <span class="detail-value">${new Date().toLocaleString()}</span>
            </div>
            <div class="detail-item">
                <span class="detail-label">Next Step:</span>
                <span class="detail-value">
                    ${booking.status === 'Pending Review' ? 
                        '<span class="badge bg-warning">Awaiting Supervisor Approval</span>' : 
                        booking.status === 'Approved' ? 
                        '<span class="badge bg-success">Proceed to Step 3 (Site Visit)</span>' : 
                        '<span class="badge bg-info">Follow workflow status</span>'}
                </span>
            </div>
            <div class="mt-3">
                <button class="btn btn-primary me-2">
                    <i class="fas fa-save me-1"></i> Save All Changes
                </button>
                <button class="btn btn-success">
                    <i class="fas fa-forward me-1"></i> Move to Next Step
                </button>
            </div>
        </div>
    `;
}
        function generateStep2Details(booking) {
            return `
                <div class="detail-card">
                    <h4>Supervisor Review Details</h4>
                    <div class="detail-item">
                        <span class="detail-label">Booking Status:</span>
                        <span class="detail-value">${booking.status}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">On-site Visit Required:</span>
                        <span class="detail-value">${booking.onsiteVisit}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Review Date:</span>
                        <span class="detail-value">${new Date().toLocaleDateString()}</span>
                    </div>
                </div>
                
                <div class="detail-card">
                    <h4>Supervisor Actions Available</h4>
                    <ul>
                        <li>Approve Booking</li>
                        <li>Reject / Request Revision</li>
                        <li>Schedule On-Site Visit</li>
                        <li>Edit Estimate</li>
                        <li>Add Internal Notes</li>
                    </ul>
                </div>
                
                <div class="detail-card">
                    <h4>System Data Stored</h4>
                    <ul>
                        <li>Client Information</li>
                        <li>Cleaning Types Selected</li>
                        <li>Room/Area Data</li>
                        <li>Service Items</li>
                        <li>Optional Tasks</li>
                        <li>Estimate Summary</li>
                        <li>Timestamp</li>
                    </ul>
                </div>
            `;
        }

        function generateStep3Details(booking) {
            return `
                <div class="detail-card">
                    <h4>Site Visit Information</h4>
                    <div class="detail-item">
                        <span class="detail-label">Visit Status:</span>
                        <span class="detail-value">${booking.onsiteVisit === 'Yes' ? 'Required' : 'Not Required'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Visit Date:</span>
                        <span class="detail-value">${new Date(booking.date).toLocaleDateString()}</span>
                    </div>
                </div>
                
                
                
                <div class="detail-card">
                    <h4>Site Visit Report Form</h4>
                    <div class="detail-item">
                        <span class="detail-label">Property Notes:</span>
                        <span class="detail-value">To be completed during site visit</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Special Requirements:</span>
                        <span class="detail-value">${booking.optionalTasks?.join(', ') || 'None specified'}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Photo Evidence:</span>
                        <span class="detail-value">To be uploaded during site visit</span>
                    </div>
                </div>
            `;
        }

        function generateStep4Details(booking) {
            const serviceItemsHTML = booking.serviceItems ? 
                booking.serviceItems.map(item => `
                    <div class="detail-item">
                        <span class="detail-label">${item.name}:</span>
                        <span class="detail-value">${booking.currency} ${item.price} × ${item.qty} = ${booking.currency} ${item.price * item.qty}</span>
                    </div>
                `).join('') : '<p>No service items</p>';
            
            return `
                <div class="detail-card">
                    <h4>Final Quotation Details</h4>
                    <div class="detail-item">
                        <span class="detail-label">Client:</span>
                        <span class="detail-value">${booking.client}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Service Type:</span>
                        <span class="detail-value">${booking.cleanType}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Booking Date:</span>
                        <span class="detail-value">${new Date(booking.date).toLocaleDateString()}</span>
                    </div>
                </div>
                
                <div class="detail-card">
                    <h4>Service Items & Pricing</h4>
                    ${serviceItemsHTML}
                    <div class="detail-item" style="border-top: 1px solid #ddd; padding-top: 10px; margin-top: 10px;">
                        <span class="detail-label"><strong>Subtotal:</strong></span>
                        <span class="detail-value"><strong>${booking.currency} ${booking.invoice}</strong></span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Tax (5%):</span>
                        <span class="detail-value">${booking.currency} ${(booking.invoice * 0.05).toFixed(2)}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label"><strong>Total:</strong></span>
                        <span class="detail-value"><strong>${booking.currency} ${(booking.invoice * 1.05).toLocaleString()}</strong></span>
                    </div>
                </div>
                
                <div class="detail-card">
                    <h4>Manager Actions</h4>
                    <ul>
                        <li>Generate Quotation (Send to client)</li>
                        <li>Request Revision (Send back to supervisor)</li>
                        <li>Reject Booking</li>
                    </ul>
                </div>
            `;
        }

        // Continue with other step detail generators...
        // Note: Due to character limit, I'll show a simplified version of the rest

        function generateStep5Details(booking) {
            return `<div class="detail-card"><h4>Client Review & Approval</h4><p>Client reviews quotation and digital booklet.</p></div>`;
        }

        function generateStep6Details(booking) {
            return `<div class="detail-card"><h4>Payment Processing</h4><p>Client completes payment with deposit options.</p></div>`;
        }

        function generateStep7Details(booking) {
            return `<div class="detail-card"><h4>Appointment Details</h4><p>Client views confirmed appointment details.</p></div>`;
        }

        function generateStep8Details(booking) {
            return `<div class="detail-card"><h4>Cleaner Assignment</h4><p>Manager assigns cleaner(s) to appointment.</p></div>`;
        }

        function generateStep9Details(booking) {
            return `<div class="detail-card"><h4>Cleaner Acceptance</h4><p>Cleaner accepts appointment with equipment verification.</p></div>`;
        }

        function generateStep10Details(booking) {
            return `<div class="detail-card"><h4>Service Execution</h4><p>Cleaner begins service execution.</p></div>`;
        }

        function generateStep11Details(booking) {
            return `<div class="detail-card"><h4>Post-Cleaning Verification</h4><p>Manager verifies completion and tasks.</p></div>`;
        }

        function generateStep12Details(booking) {
            return `
                <div class="detail-card">
                    <h4>Final Invoice & QuickBooks Sync</h4>
                    <div class="detail-item">
                        <span class="detail-label">Invoice Amount:</span>
                        <span class="detail-value">${booking.currency} ${(booking.invoice * 1.05).toLocaleString()}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">QuickBooks Status:</span>
                        <span class="detail-value">Ready for sync</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Client Notification:</span>
                        <span class="detail-value">Thank-you email with invoice attached</span>
                    </div>
                </div>
            `;
        }

        // Helper function to get step key from status
        function getStepKeyFromStatus(status) {
            if (status.includes('Pending')) return 'pending_review';
            if (status.includes('Approved')) return 'approved';
            if (status.includes('Visit Required')) return 'awaiting_visit';
            if (status.includes('Scheduled')) return 'scheduled';
            if (status.includes('Progress')) return 'in_progress';
            if (status.includes('Completed')) return 'closed';
            return 'pending_review';
        }

        // Show invoice modal
        function showInvoiceModal(booking) {
            invoiceModalBody.innerHTML = `
                <div class="invoice-preview">
                    <h6>Client: ${booking.client}</h6>
                    <p>Date: ${new Date(booking.date).toLocaleString()}</p>
                    <p>Service: ${booking.service} — ${booking.cleanType}</p>
                    <p>Location: ${booking.address}</p>
                    <hr>
                    <h6>Cost Breakdown:</h6>
                    <div class="invoice-line">
                        <span>Service Fee:</span>
                        <span>${booking.currency} ${booking.invoice.toLocaleString()}</span>
                    </div>
                    <div class="invoice-line">
                        <span>Tax (5%):</span>
                        <span>${booking.currency} ${(booking.invoice * 0.05).toFixed(2)}</span>
                    </div>
                    <div class="invoice-line">
                        <span>Deposit:</span>
                        <span>${booking.deposit === 'Paid' || booking.deposit === 'Required' ? `${booking.currency} 120` : 'Waived'}</span>
                    </div>
                    <div class="invoice-total">
                        <strong>Total: ${booking.currency} ${(booking.invoice * 1.05).toLocaleString()}</strong>
                    </div>
                </div>
            `;
            invoiceModal.show();
        }

        // Export to CSV
        function exportToCSV() {
            const headers = ['Booking ID', 'Client', 'Contact', 'Service', 'Type', 'Date/Time', 'Location', 'Address', 'Invoice', 'Status', 'On-site Visit', 'Deposit', 'Notes'];
            const data = filteredBookings.map(b => [
                b.id,
                b.client,
                b.contact,
                b.service,
                b.cleanType,
                new Date(b.date).toLocaleString(),
                b.location,
                b.address,
                `${b.currency} ${b.invoice}`,
                b.status,
                b.onsiteVisit,
                b.deposit,
                b.notes
            ]);
            
            const csvContent = [
                headers.join(','),
                ...data.map(row => row.map(cell => `"${cell}"`).join(','))
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `cleaning-bookings-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            alert('CSV exported successfully!');
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', init);
    </script>