<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Grey Line Invoice History & Management</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  :root {
    --primary: #2b5fad;
    --primary-dark: #1f4e8a;
    --primary-light: #eef5ff;
    --secondary: #10b981;
    --secondary-dark: #0da271;
    --warning: #f59e0b;
    --danger: #dc3545;
    --success: #28a745;
    --light-bg: #f8fafc;
    --card-bg: #ffffff;
    --text-primary: #1e293b;
    --text-secondary: #64748b;
    --border: #e2e8f0;
    --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --radius: 12px;
    --radius-sm: 8px;
    --grey-line: #6b7280;
    --grey-line-light: #9ca3af;
    /* Threshold Colors */
    --threshold-green: #10b981;
    --threshold-blue: #3b82f6;
    --threshold-yellow: #f59e0b;
    --threshold-red: #dc3545;
    --threshold-purple: #8b5cf6;
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: "Segoe UI", system-ui, -apple-system, sans-serif;
    background: linear-gradient(135deg, #f6f9ff 0%, #f1f5f9 100%);
    color: var(--text-primary);
    line-height: 1.6;
    min-height: 100vh;
  }

  /* Header */
  .main-header {
    background: linear-gradient(135deg, var(--grey-line) 0%, #4b5563 100%);
    color: white;
    padding: 25px 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  .header-title h1 {
    font-size: 28px;
    margin-bottom: 8px;
  }

  .header-title p {
    opacity: 0.9;
    font-size: 15px;
  }

  .header-actions {
    display: flex;
    gap: 15px;
  }

  /* Main Container */
  .main-container {
    padding: 30px;
    max-width: 1600px;
    margin: 0 auto;
  }

  /* Stats Cards */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }

  .stat-card {
    background: var(--card-bg);
    border-radius: var(--radius);
    padding: 25px;
    box-shadow: var(--shadow);
    display: flex;
    align-items: center;
    gap: 20px;
    transition: all 0.3s ease;
  }

  .stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
  }

  .stat-icon {
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, var(--grey-line), #4b5563);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 24px;
  }

  .stat-content h3 {
    font-size: 32px;
    font-weight: 700;
    color: var(--grey-line);
    margin-bottom: 5px;
  }

  .stat-content p {
    color: var(--text-secondary);
    font-size: 14px;
  }

  /* Filters */
  .filters-panel {
    background: var(--card-bg);
    border-radius: var(--radius);
    padding: 25px;
    box-shadow: var(--shadow);
    margin-bottom: 30px;
  }

  .filters-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid var(--border);
  }

  .filter-group {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 20px;
  }

  .filter-item {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .filter-item label {
    font-weight: 600;
    font-size: 14px;
    color: var(--text-primary);
  }

  .filter-select, .filter-input {
    padding: 12px 15px;
    border: 2px solid var(--border);
    border-radius: var(--radius-sm);
    font-size: 14px;
    background: white;
    transition: all 0.3s ease;
  }

  .filter-select:focus, .filter-input:focus {
    outline: none;
    border-color: var(--grey-line);
    box-shadow: 0 0 0 3px rgba(107, 114, 128, 0.1);
  }

  /* Buttons */
  .btn {
    padding: 14px 24px;
    border: none;
    border-radius: var(--radius);
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 10px;
    justify-content: center;
  }

  .btn-primary {
    background: var(--primary);
    color: white;
  }

  .btn-primary:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(43, 95, 173, 0.3);
  }

  .btn-secondary {
    background: var(--secondary);
    color: white;
  }

  .btn-secondary:hover {
    background: var(--secondary-dark);
    transform: translateY(-2px);
  }

  .btn-grey {
    background: var(--grey-line);
    color: white;
  }

  .btn-grey:hover {
    background: #4b5563;
    transform: translateY(-2px);
  }

  .btn-outline {
    background: white;
    color: var(--grey-line);
    border: 2px solid var(--grey-line);
  }

  .btn-outline:hover {
    background: #f9fafb;
  }

  .btn-danger {
    background: var(--danger);
    color: white;
  }

  .btn-danger:hover {
    background: #c82333;
    transform: translateY(-2px);
  }

  /* Invoice Management Table */
  .invoice-management {
    background: var(--card-bg);
    border-radius: var(--radius);
    padding: 25px;
    box-shadow: var(--shadow);
    margin-bottom: 30px;
  }

  .management-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
    padding-bottom: 20px;
    border-bottom: 2px solid var(--border);
  }

  .table-container {
    overflow-x: auto;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
  }

  .invoice-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
    min-width: 1400px;
  }

  .invoice-table thead {
    background: linear-gradient(135deg, var(--grey-line) 0%, #4b5563 100%);
    color: white;
  }

  .invoice-table th {
    padding: 18px 15px;
    text-align: left;
    font-weight: 600;
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .invoice-table td {
    padding: 16px 15px;
    border-bottom: 1px solid var(--border);
    vertical-align: middle;
  }

  .invoice-table tbody tr {
    transition: all 0.3s ease;
  }

  .invoice-table tbody tr:hover {
    background: var(--primary-light);
  }

  /* Status Badges */
  .status-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
  }

  .status-paid {
    background: #e8fce8;
    color: #2c7a2c;
  }

  .status-pending {
    background: #fff3cd;
    color: #856404;
  }

  .status-overdue {
    background: #fde8e8;
    color: #c53030;
  }

  .status-draft {
    background: #f8f9fa;
    color: var(--text-secondary);
  }

  .status-applied {
    background: linear-gradient(135deg, #e8fce8, #c3e6cb);
    color: #2c7a2c;
    border: 1px solid #c3e6cb;
  }

  .status-not-applied {
    background: #f8f9fa;
    color: var(--text-secondary);
  }

  /* Threshold Indicator */
  .threshold-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    display: inline-block;
    margin-right: 8px;
    vertical-align: middle;
  }

  /* Amount Cells */
  .amount-cell {
    text-align: right;
    font-weight: 600;
  }

  .grey-line-cell {
    text-align: right;
    color: var(--grey-line);
    font-weight: 600;
  }

  /* Action Buttons */
  .action-buttons {
    display: flex;
    gap: 8px;
  }

  .action-btn {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    border: none;
    background: var(--primary-light);
    color: var(--primary);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
  }

  .action-btn:hover {
    background: var(--primary);
    color: white;
    transform: translateY(-2px);
  }

  /* Pagination */
  .pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 2px solid var(--border);
  }

  .page-btn {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    border: 2px solid var(--border);
    background: white;
    color: var(--text-primary);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .page-btn:hover {
    border-color: var(--grey-line);
    background: #f9fafb;
  }

  .page-btn.active {
    background: var(--grey-line);
    color: white;
    border-color: var(--grey-line);
  }

  .page-btn.disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* Grey Line Details Panel */
  .details-panel {
    background: var(--card-bg);
    border-radius: var(--radius);
    padding: 25px;
    box-shadow: var(--shadow);
    margin-bottom: 30px;
    display: none;
  }

  .details-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid var(--border);
  }

  .details-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 25px;
    margin-bottom: 25px;
  }

  .detail-group {
    background: #f8f9fa;
    border-radius: var(--radius-sm);
    padding: 20px;
  }

  .detail-group h4 {
    color: var(--grey-line);
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .detail-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    padding-bottom: 8px;
    border-bottom: 1px dashed var(--border);
  }

  .detail-label {
    color: var(--text-secondary);
    font-size: 14px;
  }

  .detail-value {
    font-weight: 600;
    color: var(--text-primary);
  }

  /* Export Panel */
  .export-panel {
    background: var(--card-bg);
    border-radius: var(--radius);
    padding: 25px;
    box-shadow: var(--shadow);
    margin-bottom: 30px;
  }

  .export-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 20px;
  }

  /* Responsive */
  @media (max-width: 1200px) {
    .main-container {
      padding: 20px;
    }
    
    .invoice-table {
      font-size: 13px;
    }
    
    .invoice-table th,
    .invoice-table td {
      padding: 12px 10px;
    }
  }

  @media (max-width: 768px) {
    .main-header {
      flex-direction: column;
      gap: 20px;
      text-align: center;
    }
    
    .header-actions {
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .filter-group {
      grid-template-columns: 1fr;
    }
    
    .stats-grid {
      grid-template-columns: 1fr;
    }
    
    .btn {
      width: 100%;
    }
    
    .action-buttons {
      flex-wrap: wrap;
    }
    
    .details-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
</head>
<body>
  <!-- Header -->
  <header class="main-header">
    <div class="header-title">
      <h1><i class="fas fa-history"></i> Grey Line Invoice History & Management</h1>
      <p>Complete overview of all invoices with Grey Line tracking and analysis</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-primary" onclick="window.open('GreyLineFeature.html', '_self')">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
      </button>
      <button class="btn btn-secondary" onclick="exportAllData()">
        <i class="fas fa-download"></i> Export All Data
      </button>
    </div>
  </header>

  <!-- Main Container -->
  <main class="main-container">
    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-file-invoice-dollar"></i>
        </div>
        <div class="stat-content">
          <h3 id="totalInvoices">128</h3>
          <p>Total Invoices</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-chart-line"></i>
        </div>
        <div class="stat-content">
          <h3 id="greyLineInvoices">94</h3>
          <p>With Grey Line Applied</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-money-bill-wave"></i>
        </div>
        <div class="stat-content">
          <h3 id="totalRevenue">$42,850</h3>
          <p>Total Revenue</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-clock"></i>
        </div>
        <div class="stat-content">
          <h3 id="totalGreyLine">+1,245</h3>
          <p>Total Grey Line Minutes</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-coins"></i>
        </div>
        <div class="stat-content">
          <h3 id="greyLineRevenue">$12,450</h3>
          <p>Grey Line Revenue</p>
        </div>
      </div>
    </div>

    <!-- Filters Panel -->
    <div class="filters-panel">
      <div class="filters-header">
        <h2><i class="fas fa-filter"></i> Filter & Search Invoices</h2>
        <button class="btn btn-outline" onclick="resetFilters()">
          <i class="fas fa-redo"></i> Reset Filters
        </button>
      </div>
      
      <div class="filter-group">
        <div class="filter-item">
          <label><i class="fas fa-search"></i> Search Invoice/Client</label>
          <input type="text" class="filter-input" id="searchInput" placeholder="Search by invoice #, client name..." onkeyup="filterInvoices()">
        </div>
        <div class="filter-item">
          <label><i class="fas fa-calendar"></i> Date Range</label>
          <select class="filter-select" id="dateRange" onchange="filterInvoices()">
            <option value="all">All Time</option>
            <option value="today">Today</option>
            <option value="week">This Week</option>
            <option value="month" selected>This Month</option>
            <option value="quarter">This Quarter</option>
            <option value="year">This Year</option>
          </select>
        </div>
        <div class="filter-item">
          <label><i class="fas fa-chart-line"></i> Grey Line Status</label>
          <select class="filter-select" id="greyLineFilter" onchange="filterInvoices()">
            <option value="all">All Invoices</option>
            <option value="applied">With Grey Line</option>
            <option value="not-applied">Without Grey Line</option>
          </select>
        </div>
        <div class="filter-item">
          <label><i class="fas fa-dollar-sign"></i> Invoice Status</label>
          <select class="filter-select" id="statusFilter" onchange="filterInvoices()">
            <option value="all">All Status</option>
            <option value="paid">Paid</option>
            <option value="pending">Pending</option>
            <option value="overdue">Overdue</option>
            <option value="draft">Draft</option>
          </select>
        </div>
      </div>
      
      <div class="filter-group">
        <div class="filter-item">
          <label><i class="fas fa-home"></i> Service Type</label>
          <select class="filter-select" id="serviceFilter" onchange="filterInvoices()">
            <option value="all">All Services</option>
            <option value="residential">Residential</option>
            <option value="commercial">Commercial</option>
            <option value="deep-clean">Deep Clean</option>
            <option value="standard">Standard</option>
          </select>
        </div>
        <div class="filter-item">
          <label><i class="fas fa-sort-amount-up"></i> Sort By</label>
          <select class="filter-select" id="sortBy" onchange="filterInvoices()">
            <option value="date-desc">Date (Newest First)</option>
            <option value="date-asc">Date (Oldest First)</option>
            <option value="amount-desc">Amount (High to Low)</option>
            <option value="amount-asc">Amount (Low to High)</option>
            <option value="greyline-desc">Grey Line (High to Low)</option>
            <option value="greyline-asc">Grey Line (Low to High)</option>
          </select>
        </div>
        <div class="filter-item">
          <label><i class="fas fa-threshold"></i> Threshold Level</label>
          <select class="filter-select" id="thresholdFilter" onchange="filterInvoices()">
            <option value="all">All Thresholds</option>
            <option value="green">Green (0.10-0.11)</option>
            <option value="blue">Blue (0.11-0.14)</option>
            <option value="yellow">Yellow (0.15-0.16)</option>
            <option value="red">Red (0.17-0.20)</option>
            <option value="purple">Purple (0.21-0.30)</option>
          </select>
        </div>
        <div class="filter-item">
          <label><i class="fas fa-user-tag"></i> Recurrence</label>
          <select class="filter-select" id="recurrenceFilter" onchange="filterInvoices()">
            <option value="all">All Recurrence</option>
            <option value="weekly">Weekly</option>
            <option value="bi-weekly">Bi-Weekly</option>
            <option value="monthly">Monthly</option>
            <option value="one-time">One Time</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Invoice Management Table -->
    <div class="invoice-management">
      <div class="management-header">
        <h2><i class="fas fa-table"></i> Invoice Management Table</h2>
        <div class="header-actions">
          <button class="btn btn-grey" onclick="refreshData()">
            <i class="fas fa-sync-alt"></i> Refresh
          </button>
          <button class="btn btn-primary" onclick="showExportOptions()">
            <i class="fas fa-file-export"></i> Export Selected
          </button>
        </div>
      </div>
      
      <div class="table-container">
        <table class="invoice-table" id="invoiceTable">
          <thead>
            <tr>
              <th style="width: 50px;">
                <input type="checkbox" id="selectAllInvoices" onchange="selectAllInvoices()">
              </th>
              <th>Invoice #</th>
              <th>Date</th>
              <th>Client</th>
              <th>Service Type</th>
              <th>Recurrence</th>
              <th>Subtotal</th>
              <th>Grey Line</th>
              <th>Total</th>
              <th>Threshold</th>
              <th>Grey Line Status</th>
              <th>Invoice Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="invoiceTableBody">
            <!-- Invoices will be populated by JavaScript -->
          </tbody>
        </table>
      </div>
      
      <!-- Pagination -->
      <div class="pagination">
        <button class="page-btn" onclick="changePage('first')" id="firstPage">
          <i class="fas fa-angle-double-left"></i>
        </button>
        <button class="page-btn" onclick="changePage('prev')" id="prevPage">
          <i class="fas fa-angle-left"></i>
        </button>
        <span id="pageNumbers"></span>
        <button class="page-btn" onclick="changePage('next')" id="nextPage">
          <i class="fas fa-angle-right"></i>
        </button>
        <button class="page-btn" onclick="changePage('last')" id="lastPage">
          <i class="fas fa-angle-double-right"></i>
        </button>
      </div>
    </div>

    <!-- Grey Line Details Panel -->
    <div class="details-panel" id="detailsPanel">
      <div class="details-header">
        <h2><i class="fas fa-info-circle"></i> Grey Line Details</h2>
        <button class="btn btn-outline" onclick="hideDetails()">
          <i class="fas fa-times"></i> Close
        </button>
      </div>
      
      <div id="detailsContent">
        <!-- Details will be populated by JavaScript -->
      </div>
    </div>

    <!-- Export Panel (Hidden by default) -->
    <div class="export-panel" id="exportPanel" style="display: none;">
      <div class="details-header">
        <h2><i class="fas fa-file-export"></i> Export Options</h2>
        <button class="btn btn-outline" onclick="hideExportPanel()">
          <i class="fas fa-times"></i> Close
        </button>
      </div>
      
      <div class="export-options">
        <button class="btn btn-secondary" onclick="exportCSV()">
          <i class="fas fa-file-csv"></i> Export as CSV
        </button>
        <button class="btn btn-secondary" onclick="exportExcel()">
          <i class="fas fa-file-excel"></i> Export as Excel
        </button>
        <button class="btn btn-secondary" onclick="exportPDF()">
          <i class="fas fa-file-pdf"></i> Export as PDF
        </button>
        <button class="btn btn-secondary" onclick="exportJSON()">
          <i class="fas fa-code"></i> Export as JSON
        </button>
      </div>
      
      <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: var(--radius-sm);">
        <p style="color: var(--text-secondary); font-size: 14px;">
          <i class="fas fa-info-circle"></i> Export will include selected invoices with all Grey Line details, threshold information, and audit logs.
        </p>
      </div>
    </div>
  </main>

  <script>
    // Invoice Data - Extended with more realistic data
    const allInvoices = [
      {
        id: 1,
        invoiceNumber: 'INV-2025-03321',
        date: '2025-03-15',
        client: 'Maria Santos',
        serviceType: 'Deep Clean',
        recurrence: 'Weekly',
        subtotal: 420,
        greyLine: 28,
        total: 476.24,
        threshold: 0.14,
        greyLineStatus: 'applied',
        invoiceStatus: 'paid',
        greyLineDetails: {
          appliedDate: '2025-03-14 10:30',
          appliedBy: 'John Manager',
          reasons: ['Weekly recurrence buildup', 'Pets in home', 'Kitchen grease buildup'],
          parameters: {
            recurrence: 4,
            dirtLevel: 5,
            pets: 5,
            kitchen: 3,
            seasonal: 4
          },
          auditLog: [
            { date: '2025-03-14 10:30', action: 'Grey Line Applied', user: 'John Manager', amount: 28 },
            { date: '2025-03-13 14:15', action: 'Invoice Created', user: 'System', amount: 0 }
          ]
        }
      },
      {
        id: 2,
        invoiceNumber: 'INV-2025-03322',
        date: '2025-03-14',
        client: 'John Smith',
        serviceType: 'Standard Clean',
        recurrence: 'Bi-Weekly',
        subtotal: 280,
        greyLine: 18,
        total: 318.54,
        threshold: 0.12,
        greyLineStatus: 'applied',
        invoiceStatus: 'pending',
        greyLineDetails: {
          appliedDate: '2025-03-13 15:45',
          appliedBy: 'Jane Supervisor',
          reasons: ['Residential client type', 'Moderate dirt level'],
          parameters: {
            recurrence: 3,
            dirtLevel: 4,
            pets: 0,
            kitchen: 2,
            seasonal: 3
          },
          auditLog: [
            { date: '2025-03-13 15:45', action: 'Grey Line Applied', user: 'Jane Supervisor', amount: 18 },
            { date: '2025-03-12 09:20', action: 'Invoice Created', user: 'System', amount: 0 }
          ]
        }
      },
      {
        id: 3,
        invoiceNumber: 'INV-2025-03323',
        date: '2025-03-13',
        client: 'Office Building A',
        serviceType: 'Commercial',
        recurrence: 'Monthly',
        subtotal: 1250,
        greyLine: 45,
        total: 1463.75,
        threshold: 0.18,
        greyLineStatus: 'applied',
        invoiceStatus: 'paid',
        greyLineDetails: {
          appliedDate: '2025-03-12 11:20',
          appliedBy: 'John Manager',
          reasons: ['Commercial foot traffic', 'Monthly dirt buildup'],
          parameters: {
            recurrence: 6,
            dirtLevel: 7,
            pets: 0,
            kitchen: 0,
            seasonal: 8
          },
          auditLog: [
            { date: '2025-03-12 11:20', action: 'Grey Line Applied', user: 'John Manager', amount: 45 },
            { date: '2025-03-11 16:30', action: 'Invoice Created', user: 'System', amount: 0 }
          ]
        }
      },
      {
        id: 4,
        invoiceNumber: 'INV-2025-03324',
        date: '2025-03-12',
        client: 'Robert Johnson',
        serviceType: 'Residential',
        recurrence: 'Weekly',
        subtotal: 350,
        greyLine: 0,
        total: 395.50,
        threshold: 0,
        greyLineStatus: 'not-applied',
        invoiceStatus: 'overdue',
        greyLineDetails: null
      },
      {
        id: 5,
        invoiceNumber: 'INV-2025-03325',
        date: '2025-03-11',
        client: 'Sarah Williams',
        serviceType: 'Deep Clean',
        recurrence: 'One Time',
        subtotal: 520,
        greyLine: 32,
        total: 588.16,
        threshold: 0.15,
        greyLineStatus: 'applied',
        invoiceStatus: 'paid',
        greyLineDetails: {
          appliedDate: '2025-03-10 14:30',
          appliedBy: 'Jane Supervisor',
          reasons: ['Extra clutter handling', 'Stain treatment', 'Bathroom severity'],
          parameters: {
            recurrence: 2,
            dirtLevel: 6,
            pets: 0,
            kitchen: 4,
            seasonal: 0
          },
          auditLog: [
            { date: '2025-03-10 14:30', action: 'Grey Line Applied', user: 'Jane Supervisor', amount: 32 },
            { date: '2025-03-09 11:15', action: 'Invoice Created', user: 'System', amount: 0 }
          ]
        }
      },
      {
        id: 6,
        invoiceNumber: 'INV-2025-03326',
        date: '2025-03-10',
        client: 'Mike Brown',
        serviceType: 'Standard Clean',
        recurrence: 'Bi-Weekly',
        subtotal: 240,
        greyLine: 15,
        total: 272.10,
        threshold: 0.13,
        greyLineStatus: 'applied',
        invoiceStatus: 'pending',
        greyLineDetails: {
          appliedDate: '2025-03-09 16:45',
          appliedBy: 'John Manager',
          reasons: ['Long-term client pattern', 'Navigation and setup time'],
          parameters: {
            recurrence: 3,
            dirtLevel: 3,
            pets: 2,
            kitchen: 2,
            seasonal: 2
          },
          auditLog: [
            { date: '2025-03-09 16:45', action: 'Grey Line Applied', user: 'John Manager', amount: 15 },
            { date: '2025-03-08 10:20', action: 'Invoice Created', user: 'System', amount: 0 }
          ]
        }
      },
      {
        id: 7,
        invoiceNumber: 'INV-2025-03327',
        date: '2025-03-09',
        client: 'Clean Sweep Inc.',
        serviceType: 'Commercial',
        recurrence: 'Monthly',
        subtotal: 980,
        greyLine: 25,
        total: 1135.85,
        threshold: 0.11,
        greyLineStatus: 'applied',
        invoiceStatus: 'paid',
        greyLineDetails: {
          appliedDate: '2025-03-08 09:15',
          appliedBy: 'Jane Supervisor',
          reasons: ['Commercial foot traffic', 'Task expansion'],
          parameters: {
            recurrence: 5,
            dirtLevel: 4,
            pets: 0,
            kitchen: 0,
            seasonal: 0
          },
          auditLog: [
            { date: '2025-03-08 09:15', action: 'Grey Line Applied', user: 'Jane Supervisor', amount: 25 },
            { date: '2025-03-07 14:30', action: 'Invoice Created', user: 'System', amount: 0 }
          ]
        }
      },
      {
        id: 8,
        invoiceNumber: 'INV-2025-03328',
        date: '2025-03-08',
        client: 'Lisa Chen',
        serviceType: 'Residential',
        recurrence: 'Weekly',
        subtotal: 380,
        greyLine: 0,
        total: 429.40,
        threshold: 0,
        greyLineStatus: 'not-applied',
        invoiceStatus: 'draft',
        greyLineDetails: null
      },
      {
        id: 9,
        invoiceNumber: 'INV-2025-03329',
        date: '2025-03-07',
        client: 'Tom Wilson',
        serviceType: 'Deep Clean',
        recurrence: 'One Time',
        subtotal: 620,
        greyLine: 42,
        total: 748.66,
        threshold: 0.20,
        greyLineStatus: 'applied',
        invoiceStatus: 'paid',
        greyLineDetails: {
          appliedDate: '2025-03-06 13:20',
          appliedBy: 'John Manager',
          reasons: ['Winter seasonal dirt', 'Extra clutter handling', 'Stain treatment'],
          parameters: {
            recurrence: 3,
            dirtLevel: 8,
            pets: 0,
            kitchen: 5,
            seasonal: 6
          },
          auditLog: [
            { date: '2025-03-06 13:20', action: 'Grey Line Applied', user: 'John Manager', amount: 42 },
            { date: '2025-03-05 11:45', action: 'Invoice Created', user: 'System', amount: 0 }
          ]
        }
      },
      {
        id: 10,
        invoiceNumber: 'INV-2025-03330',
        date: '2025-03-06',
        client: 'Green Office Corp',
        serviceType: 'Commercial',
        recurrence: 'Monthly',
        subtotal: 1120,
        greyLine: 38,
        total: 1309.14,
        threshold: 0.16,
        greyLineStatus: 'applied',
        invoiceStatus: 'pending',
        greyLineDetails: {
          appliedDate: '2025-03-05 10:45',
          appliedBy: 'Jane Supervisor',
          reasons: ['Commercial foot traffic', 'Monthly dirt buildup', 'Task expansion'],
          parameters: {
            recurrence: 7,
            dirtLevel: 6,
            pets: 0,
            kitchen: 0,
            seasonal: 4
          },
          auditLog: [
            { date: '2025-03-05 10:45', action: 'Grey Line Applied', user: 'Jane Supervisor', amount: 38 },
            { date: '2025-03-04 15:20', action: 'Invoice Created', user: 'System', amount: 0 }
          ]
        }
      }
    ];

    // State Management
    let filteredInvoices = [...allInvoices];
    let selectedInvoices = new Set();
    let currentPage = 1;
    const invoicesPerPage = 10;
    let currentInvoiceDetails = null;

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      updateStats();
      populateInvoiceTable();
      setupPagination();
    });

    // Update statistics
    function updateStats() {
      const totalInvoices = allInvoices.length;
      const greyLineInvoices = allInvoices.filter(inv => inv.greyLineStatus === 'applied').length;
      const totalRevenue = allInvoices.reduce((sum, inv) => sum + inv.total, 0);
      const totalGreyLine = allInvoices.reduce((sum, inv) => sum + inv.greyLine, 0);
      const greyLineRevenue = allInvoices.reduce((sum, inv) => sum + (inv.greyLine || 0), 0);

      document.getElementById('totalInvoices').textContent = totalInvoices;
      document.getElementById('greyLineInvoices').textContent = greyLineInvoices;
      document.getElementById('totalRevenue').textContent = `$${totalRevenue.toFixed(0)}`;
      document.getElementById('totalGreyLine').textContent = `+${totalGreyLine}`;
      document.getElementById('greyLineRevenue').textContent = `$${greyLineRevenue}`;
    }

    // Get threshold color and label
    function getThresholdInfo(threshold) {
      if (threshold === 0) return { color: '#e2e8f0', label: 'N/A' };
      
      if (threshold >= 0.10 && threshold <= 0.11) return { color: 'var(--threshold-green)', label: 'Green' };
      if (threshold > 0.11 && threshold <= 0.14) return { color: 'var(--threshold-blue)', label: 'Blue' };
      if (threshold > 0.14 && threshold <= 0.16) return { color: 'var(--threshold-yellow)', label: 'Yellow' };
      if (threshold > 0.16 && threshold <= 0.20) return { color: 'var(--threshold-red)', label: 'Red' };
      if (threshold > 0.20 && threshold <= 0.30) return { color: 'var(--threshold-purple)', label: 'Purple' };
      
      return { color: '#e2e8f0', label: 'N/A' };
    }

    // Get status badge
    function getStatusBadge(status) {
      switch(status) {
        case 'paid': return '<span class="status-badge status-paid"><i class="fas fa-check-circle"></i> Paid</span>';
        case 'pending': return '<span class="status-badge status-pending"><i class="fas fa-clock"></i> Pending</span>';
        case 'overdue': return '<span class="status-badge status-overdue"><i class="fas fa-exclamation-circle"></i> Overdue</span>';
        case 'draft': return '<span class="status-badge status-draft"><i class="fas fa-edit"></i> Draft</span>';
        default: return '<span class="status-badge status-draft">Unknown</span>';
      }
    }

    // Get Grey Line status badge
    function getGreyLineStatusBadge(status) {
      if (status === 'applied') {
        return '<span class="status-badge status-applied"><i class="fas fa-chart-line"></i> Applied</span>';
      } else {
        return '<span class="status-badge status-not-applied"><i class="fas fa-minus"></i> Not Applied</span>';
      }
    }

    // Filter invoices based on criteria
    function filterInvoices() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const dateRange = document.getElementById('dateRange').value;
      const greyLineFilter = document.getElementById('greyLineFilter').value;
      const statusFilter = document.getElementById('statusFilter').value;
      const serviceFilter = document.getElementById('serviceFilter').value;
      const thresholdFilter = document.getElementById('thresholdFilter').value;
      const recurrenceFilter = document.getElementById('recurrenceFilter').value;
      const sortBy = document.getElementById('sortBy').value;

      // Apply filters
      filteredInvoices = allInvoices.filter(invoice => {
        // Search filter
        if (searchTerm && !(
          invoice.invoiceNumber.toLowerCase().includes(searchTerm) ||
          invoice.client.toLowerCase().includes(searchTerm)
        )) return false;

        // Date range filter
        if (dateRange !== 'all') {
          const invoiceDate = new Date(invoice.date);
          const today = new Date();
          const diffDays = Math.floor((today - invoiceDate) / (1000 * 60 * 60 * 24));
          
          switch(dateRange) {
            case 'today':
              if (diffDays !== 0) return false;
              break;
            case 'week':
              if (diffDays > 7) return false;
              break;
            case 'month':
              if (diffDays > 30) return false;
              break;
            case 'quarter':
              if (diffDays > 90) return false;
              break;
            case 'year':
              if (diffDays > 365) return false;
              break;
          }
        }

        // Grey Line filter
        if (greyLineFilter !== 'all' && invoice.greyLineStatus !== greyLineFilter) {
          return false;
        }

        // Invoice status filter
        if (statusFilter !== 'all' && invoice.invoiceStatus !== statusFilter) {
          return false;
        }

        // Service type filter
        if (serviceFilter !== 'all' && !invoice.serviceType.toLowerCase().includes(serviceFilter.toLowerCase())) {
          return false;
        }

        // Threshold filter
        if (thresholdFilter !== 'all') {
          const thresholdInfo = getThresholdInfo(invoice.threshold);
          if (thresholdInfo.label.toLowerCase() !== thresholdFilter) {
            return false;
          }
        }

        // Recurrence filter
        if (recurrenceFilter !== 'all' && invoice.recurrence.toLowerCase().replace('-', ' ') !== recurrenceFilter.toLowerCase().replace('-', ' ')) {
          return false;
        }

        return true;
      });

      // Sort invoices
      filteredInvoices.sort((a, b) => {
        switch(sortBy) {
          case 'date-desc':
            return new Date(b.date) - new Date(a.date);
          case 'date-asc':
            return new Date(a.date) - new Date(b.date);
          case 'amount-desc':
            return b.total - a.total;
          case 'amount-asc':
            return a.total - b.total;
          case 'greyline-desc':
            return b.greyLine - a.greyLine;
          case 'greyline-asc':
            return a.greyLine - b.greyLine;
          default:
            return new Date(b.date) - new Date(a.date);
        }
      });

      currentPage = 1;
      populateInvoiceTable();
      setupPagination();
      updateStats();
    }

    // Reset all filters
    function resetFilters() {
      document.getElementById('searchInput').value = '';
      document.getElementById('dateRange').value = 'month';
      document.getElementById('greyLineFilter').value = 'all';
      document.getElementById('statusFilter').value = 'all';
      document.getElementById('serviceFilter').value = 'all';
      document.getElementById('thresholdFilter').value = 'all';
      document.getElementById('recurrenceFilter').value = 'all';
      document.getElementById('sortBy').value = 'date-desc';
      
      filterInvoices();
    }

    // Populate invoice table
    function populateInvoiceTable() {
      const tableBody = document.getElementById('invoiceTableBody');
      tableBody.innerHTML = '';

      const startIndex = (currentPage - 1) * invoicesPerPage;
      const endIndex = startIndex + invoicesPerPage;
      const pageInvoices = filteredInvoices.slice(startIndex, endIndex);

      pageInvoices.forEach(invoice => {
        const thresholdInfo = getThresholdInfo(invoice.threshold);
        
        const row = document.createElement('tr');
        row.innerHTML = `
          <td><input type="checkbox" class="invoice-checkbox" value="${invoice.id}" onchange="toggleInvoiceSelection(${invoice.id})" ${selectedInvoices.has(invoice.id) ? 'checked' : ''}></td>
          <td><strong>${invoice.invoiceNumber}</strong></td>
          <td>${formatDate(invoice.date)}</td>
          <td>${invoice.client}</td>
          <td>${invoice.serviceType}</td>
          <td>${invoice.recurrence}</td>
          <td class="amount-cell">$${invoice.subtotal.toFixed(2)}</td>
          <td class="grey-line-cell">${invoice.greyLine > 0 ? `+$${invoice.greyLine.toFixed(2)}` : '-'}</td>
          <td class="amount-cell">$${invoice.total.toFixed(2)}</td>
          <td>
            <span class="threshold-indicator" style="background: ${thresholdInfo.color};"></span>
            <span>${thresholdInfo.label}</span>
          </td>
          <td>${getGreyLineStatusBadge(invoice.greyLineStatus)}</td>
          <td>${getStatusBadge(invoice.invoiceStatus)}</td>
          <td>
            <div class="action-buttons">
              <button class="action-btn" onclick="viewInvoiceDetails(${invoice.id})" title="View Details">
                <i class="fas fa-eye"></i>
              </button>
              <button class="action-btn" onclick="editInvoice(${invoice.id})" title="Edit Invoice">
                <i class="fas fa-edit"></i>
              </button>
              <button class="action-btn" onclick="applyGreyLineToInvoice(${invoice.id})" title="Apply Grey Line" ${invoice.greyLineStatus === 'applied' ? 'disabled style="opacity:0.5;cursor:not-allowed;"' : ''}>
                <i class="fas fa-chart-line"></i>
              </button>
              <button class="action-btn" onclick="deleteInvoice(${invoice.id})" title="Delete Invoice">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        `;
        
        tableBody.appendChild(row);
      });
    }

    // Format date
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric' 
      });
    }

    // Setup pagination
    function setupPagination() {
      const totalPages = Math.ceil(filteredInvoices.length / invoicesPerPage);
      const pageNumbers = document.getElementById('pageNumbers');
      pageNumbers.innerHTML = '';

      for (let i = 1; i <= totalPages; i++) {
        const pageBtn = document.createElement('button');
        pageBtn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
        pageBtn.textContent = i;
        pageBtn.onclick = () => {
          currentPage = i;
          populateInvoiceTable();
          setupPagination();
        };
        pageNumbers.appendChild(pageBtn);
      }

      // Update navigation buttons
      document.getElementById('firstPage').disabled = currentPage === 1;
      document.getElementById('prevPage').disabled = currentPage === 1;
      document.getElementById('nextPage').disabled = currentPage === totalPages;
      document.getElementById('lastPage').disabled = currentPage === totalPages;
    }

    // Change page
    function changePage(direction) {
      const totalPages = Math.ceil(filteredInvoices.length / invoicesPerPage);
      
      switch(direction) {
        case 'first':
          currentPage = 1;
          break;
        case 'prev':
          if (currentPage > 1) currentPage--;
          break;
        case 'next':
          if (currentPage < totalPages) currentPage++;
          break;
        case 'last':
          currentPage = totalPages;
          break;
      }
      
      populateInvoiceTable();
      setupPagination();
    }

    // Toggle invoice selection
    function toggleInvoiceSelection(invoiceId) {
      if (selectedInvoices.has(invoiceId)) {
        selectedInvoices.delete(invoiceId);
      } else {
        selectedInvoices.add(invoiceId);
      }
    }

    // Select all invoices
    function selectAllInvoices() {
      const selectAll = document.getElementById('selectAllInvoices');
      const checkboxes = document.querySelectorAll('.invoice-checkbox');
      
      if (selectAll.checked) {
        const startIndex = (currentPage - 1) * invoicesPerPage;
        const endIndex = startIndex + invoicesPerPage;
        const pageInvoices = filteredInvoices.slice(startIndex, endIndex);
        
        pageInvoices.forEach(invoice => selectedInvoices.add(invoice.id));
        checkboxes.forEach(cb => cb.checked = true);
      } else {
        selectedInvoices.clear();
        checkboxes.forEach(cb => cb.checked = false);
      }
    }

    // View invoice details
    function viewInvoiceDetails(invoiceId) {
      const invoice = allInvoices.find(inv => inv.id === invoiceId);
      if (!invoice) return;
      
      currentInvoiceDetails = invoice;
      
      let detailsHtml = `
        <div class="details-grid">
          <div class="detail-group">
            <h4><i class="fas fa-file-invoice"></i> Invoice Information</h4>
            <div class="detail-row">
              <span class="detail-label">Invoice Number:</span>
              <span class="detail-value">${invoice.invoiceNumber}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Date:</span>
              <span class="detail-value">${formatDate(invoice.date)}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Client:</span>
              <span class="detail-value">${invoice.client}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Service Type:</span>
              <span class="detail-value">${invoice.serviceType}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Recurrence:</span>
              <span class="detail-value">${invoice.recurrence}</span>
            </div>
          </div>
          
          <div class="detail-group">
            <h4><i class="fas fa-dollar-sign"></i> Financial Details</h4>
            <div class="detail-row">
              <span class="detail-label">Subtotal:</span>
              <span class="detail-value">$${invoice.subtotal.toFixed(2)}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Grey Line:</span>
              <span class="detail-value">${invoice.greyLine > 0 ? `+$${invoice.greyLine.toFixed(2)}` : 'Not Applied'}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Total Amount:</span>
              <span class="detail-value">$${invoice.total.toFixed(2)}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Threshold Level:</span>
              <span class="detail-value">${invoice.threshold > 0 ? invoice.threshold.toFixed(2) : 'N/A'}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Invoice Status:</span>
              <span class="detail-value">${getStatusBadge(invoice.invoiceStatus).replace(/<[^>]*>/g, '')}</span>
            </div>
          </div>
      `;
      
      if (invoice.greyLineDetails) {
        detailsHtml += `
          <div class="detail-group">
            <h4><i class="fas fa-chart-line"></i> Grey Line Application</h4>
            <div class="detail-row">
              <span class="detail-label">Applied Date:</span>
              <span class="detail-value">${invoice.greyLineDetails.appliedDate}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Applied By:</span>
              <span class="detail-value">${invoice.greyLineDetails.appliedBy}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Grey Line Amount:</span>
              <span class="detail-value">+$${invoice.greyLine.toFixed(2)}</span>
            </div>
          </div>
          
          <div class="detail-group">
            <h4><i class="fas fa-list-check"></i> Applied Reasons</h4>
            ${invoice.greyLineDetails.reasons.map(reason => `
              <div class="detail-row">
                <span class="detail-label"><i class="fas fa-check"></i></span>
                <span class="detail-value">${reason}</span>
              </div>
            `).join('')}
          </div>
          
          <div class="detail-group">
            <h4><i class="fas fa-sliders-h"></i> Parameters Used</h4>
            ${Object.entries(invoice.greyLineDetails.parameters).map(([key, value]) => `
              <div class="detail-row">
                <span class="detail-label">${key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}:</span>
                <span class="detail-value">+${value} min</span>
              </div>
            `).join('')}
          </div>
          
          <div class="detail-group">
            <h4><i class="fas fa-history"></i> Audit Log</h4>
            ${invoice.greyLineDetails.auditLog.map(log => `
              <div class="detail-row" style="border-bottom: none; padding-bottom: 5px;">
                <div style="display: flex; justify-content: space-between; width: 100%;">
                  <span class="detail-label">${log.date}</span>
                  <span class="detail-value">${log.action}</span>
                </div>
                <div style="font-size: 12px; color: var(--text-secondary); margin-top: 2px;">
                  <i class="fas fa-user"></i> ${log.user} ${log.amount > 0 ? `â€¢ +$${log.amount}` : ''}
                </div>
              </div>
            `).join('')}
          </div>
        `;
      } else {
        detailsHtml += `
          <div class="detail-group">
            <h4><i class="fas fa-chart-line"></i> Grey Line Status</h4>
            <div class="detail-row">
              <span class="detail-label">Grey Line Applied:</span>
              <span class="detail-value">No</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Status:</span>
              <span class="detail-value">Available for Application</span>
            </div>
          </div>
        `;
      }
      
      detailsHtml += `</div>`;
      
      document.getElementById('detailsContent').innerHTML = detailsHtml;
      document.getElementById('detailsPanel').style.display = 'block';
      
      // Scroll to details panel
      document.getElementById('detailsPanel').scrollIntoView({ behavior: 'smooth' });
    }

    // Hide details panel
    function hideDetails() {
      document.getElementById('detailsPanel').style.display = 'none';
    }

    // Show export options
    function showExportOptions() {
      if (selectedInvoices.size === 0) {
        showNotification('Please select invoices to export.', 'warning');
        return;
      }
      
      document.getElementById('exportPanel').style.display = 'block';
      document.getElementById('exportPanel').scrollIntoView({ behavior: 'smooth' });
    }

    // Hide export panel
    function hideExportPanel() {
      document.getElementById('exportPanel').style.display = 'none';
    }

    // Export functions
    function exportCSV() {
      const selectedInvoiceData = allInvoices.filter(inv => selectedInvoices.has(inv.id));
      const csvContent = convertToCSV(selectedInvoiceData);
      downloadFile(csvContent, 'grey-line-invoices.csv', 'text/csv');
      showNotification('CSV export completed successfully!', 'success');
    }

    function exportExcel() {
      showNotification('Excel export feature coming soon!', 'info');
    }

    function exportPDF() {
      showNotification('PDF export feature coming soon!', 'info');
    }

    function exportJSON() {
      const selectedInvoiceData = allInvoices.filter(inv => selectedInvoices.has(inv.id));
      const jsonContent = JSON.stringify(selectedInvoiceData, null, 2);
      downloadFile(jsonContent, 'grey-line-invoices.json', 'application/json');
      showNotification('JSON export completed successfully!', 'success');
    }

    function exportAllData() {
      const jsonContent = JSON.stringify(allInvoices, null, 2);
      downloadFile(jsonContent, 'all-grey-line-invoices.json', 'application/json');
      showNotification('All data exported successfully!', 'success');
    }

    // Convert to CSV
    function convertToCSV(data) {
      const headers = ['Invoice #', 'Date', 'Client', 'Service Type', 'Recurrence', 'Subtotal', 'Grey Line', 'Total', 'Threshold', 'Grey Line Status', 'Invoice Status'];
      const rows = data.map(invoice => [
        invoice.invoiceNumber,
        invoice.date,
        invoice.client,
        invoice.serviceType,
        invoice.recurrence,
        invoice.subtotal,
        invoice.greyLine,
        invoice.total,
        invoice.threshold,
        invoice.greyLineStatus,
        invoice.invoiceStatus
      ]);
      
      return [
        headers.join(','),
        ...rows.map(row => row.join(','))
      ].join('\n');
    }

    // Download file
    function downloadFile(content, fileName, contentType) {
      const blob = new Blob([content], { type: contentType });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = fileName;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // Edit invoice
    function editInvoice(invoiceId) {
      showNotification('Edit feature coming soon!', 'info');
    }

    // Apply Grey Line to invoice
    function applyGreyLineToInvoice(invoiceId) {
      const invoice = allInvoices.find(inv => inv.id === invoiceId);
      if (invoice && invoice.greyLineStatus !== 'applied') {
        if (confirm(`Apply Grey Line to invoice ${invoice.invoiceNumber}?\n\nClient: ${invoice.client}\nSubtotal: $${invoice.subtotal.toFixed(2)}`)) {
          // In a real app, this would open the Grey Line application interface
          showNotification(`Opening Grey Line application for ${invoice.invoiceNumber}...`, 'info');
          // You could redirect to the main dashboard with this invoice selected
          window.open(`step12-greyline-feature.html?invoice=${invoiceId}`, '_self');
        }
      } else {
        showNotification('Grey Line already applied to this invoice.', 'warning');
      }
    }

    // Delete invoice
    function deleteInvoice(invoiceId) {
      const invoice = allInvoices.find(inv => inv.id === invoiceId);
      if (invoice && confirm(`Are you sure you want to delete invoice ${invoice.invoiceNumber}?\n\nThis action cannot be undone.`)) {
        showNotification(`Invoice ${invoice.invoiceNumber} deleted successfully.`, 'success');
        // In a real app, this would make an API call to delete the invoice
        // For now, we'll just filter it out
        const index = allInvoices.findIndex(inv => inv.id === invoiceId);
        if (index !== -1) {
          allInvoices.splice(index, 1);
          filterInvoices();
          updateStats();
        }
      }
    }

    // Refresh data
    function refreshData() {
      showNotification('Data refreshed successfully!', 'success');
      filterInvoices();
    }

    // Show notification
    function showNotification(message, type = 'info') {
      // Create notification element
      const notification = document.createElement('div');
      notification.style.position = 'fixed';
      notification.style.top = '20px';
      notification.style.right = '20px';
      notification.style.padding = '15px 20px';
      notification.style.borderRadius = '8px';
      notification.style.color = 'white';
      notification.style.fontWeight = '600';
      notification.style.zIndex = '9999';
      notification.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
      notification.style.maxWidth = '400px';
      notification.style.transform = 'translateX(120%)';
      notification.style.transition = 'transform 0.3s ease';
      
      // Set colors based on type
      switch(type) {
        case 'success':
          notification.style.background = 'linear-gradient(135deg, #10b981 0%, #0da271 100%)';
          break;
        case 'error':
          notification.style.background = 'linear-gradient(135deg, #dc3545 0%, #c82333 100%)';
          break;
        case 'warning':
          notification.style.background = 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)';
          break;
        default:
          notification.style.background = 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)';
      }
      
      notification.innerHTML = `
        <div style="display: flex; align-items: center; gap: 10px;">
          <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
          <div>${message}</div>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      // Animate in
      setTimeout(() => {
        notification.style.transform = 'translateX(0)';
      }, 10);
      
      // Auto remove after 5 seconds
      setTimeout(() => {
        notification.style.transform = 'translateX(120%)';
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }, 5000);
      
      // Click to dismiss
      notification.onclick = function() {
        notification.style.transform = 'translateX(120%)';
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      };
    }
  </script>
</body>
</html>