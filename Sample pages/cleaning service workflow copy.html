<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cleaning Service Workflow Dashboard</title>
<style>
  :root{
    --bg:#f7fafc; --card:#ffffff; --accent:#0ea5a4; --muted:#64748b;
    --node-size:80px;
  }
  *{box-sizing:border-box}
  body{font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial; margin:0;background:var(--bg);color:#0f1724;}
  .wrap{max-width:1200px;margin:24px auto;padding:16px}
  h1{font-size:24px;margin:0 0 12px}
  p.lead{color:var(--muted);margin:6px 0 18px}

  .stepper-wrap{background:var(--card);border-radius:12px;padding:14px;border:1px solid rgba(15,23,36,0.04);}
  .controls-row{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:8px}
  .nodes-row{display:flex;align-items:center;gap:12px;padding:8px 6px;overflow:auto;scroll-behavior:smooth}
  .nodes-row::-webkit-scrollbar{height:10px}
  .nodes-row::-webkit-scrollbar-thumb{background:linear-gradient(90deg,var(--accent),#06b6d4);border-radius:8px}

  .node{min-width:var(--node-size);height:var(--node-size);border-radius:50%;background:rgba(14,165,164,0.06);display:flex;align-items:center;justify-content:center;flex-shrink:0;position:relative;cursor:pointer;transition:transform .18s ease,box-shadow .18s}
  .node:hover{transform:translateY(-6px)}
  .node.active{background:linear-gradient(135deg, rgba(14,165,164,0.14), rgba(6,182,212,0.08));box-shadow:0 8px 18px rgba(14,165,164,0.08)}
  .node .num{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:#e6fffb;font-weight:700;color:var(--accent)}
  .node .label{position:absolute;top:calc(100% + 8px);left:50%;transform:translateX(-50%);white-space:nowrap;font-size:12px;color:var(--muted);max-width:120px;overflow:hidden;text-overflow:ellipsis}

  .connector{height:4px;background:linear-gradient(90deg,#e6eef0,#e6eef0);flex:0 0 48px;border-radius:6px}
  .connector.filled{background:linear-gradient(90deg,var(--accent),#06b6d4)}

  .details{margin-top:16px}
  .card{background:var(--card);padding:16px;border-radius:10px;border:1px solid rgba(15,23,36,0.04)}
  .card h3{margin:0 0 8px}
  .card .meta{color:var(--muted);font-size:13px;margin-bottom:10px}
  .card .content{font-size:14px;color:#0f1724;line-height:1.45;white-space:pre-wrap}

  .controls{display:flex;gap:8px;align-items:center}
  .btn{background:transparent;border:1px solid rgba(15,23,36,0.06);padding:8px 12px;border-radius:8px;color:var(--accent);cursor:pointer}
  .btn.primary{background:linear-gradient(90deg,var(--accent),#06b6d4);color:white;border:none}

  table{width:100%;border-collapse:collapse;margin-bottom:12px}
  table, th, td{border:1px solid #e6eef0}
  th,td{padding:6px;text-align:left}
  th{background:#f0fdfa}
  .task-item{display:flex;justify-content:space-between;align-items:center;padding:4px 8px;border-radius:6px;background:#f0fdfa;margin-bottom:4px}
  .task-item button{background:transparent;border:none;color:#ef4444;font-weight:600;cursor:pointer}
  .action-btn button{margin-right:8px;padding:6px 10px;border-radius:6px;border:none;color:white;cursor:pointer}
  .action-accept{background:#10b981;}
  .action-reject{background:#ef4444;}
  .action-reschedule{background:#f59e0b;}
  .action-sitevisit{background:#3b82f6;}
  .action-generate{background:#06b6d4;}
  .action-revision{background:#f97316;}
  .action-complete{background:#14b8a6;}
  .small{font-size:12px;color:var(--muted)}
  @media (max-width:720px){ .wrap{padding:12px} .node .label{display:none} }
</style>
</head>
<body>
<div class="wrap">
  
  <h1>Cleaning Service Workflow Dashboard</h1>
  <p class="lead">Click any step node to view its content and perform actions.</p>
  <div class="stepper-wrap">
    <div class="controls-row">
      <div style="font-weight:700">Workflow Steps</div>
      <div class="controls">
        <button id="prevBtn" class="btn">â—€ Prev</button>
        <button id="nextBtn" class="btn">Next â–¶</button>
        <button id="playBtn" class="btn">Play</button>
      </div>
    </div>
    <div id="nodesRow" class="nodes-row" tabindex="0" aria-label="Workflow steps"></div>
    <div class="details">
      <div id="detailCard" class="card">
        <h3 id="detailTitle">Step</h3>
        <div class="meta" id="detailMeta">Status info</div>
        <div id="detailContent" class="content">Select a step to view details.</div>
      </div>
    </div>
  </div>
</div>

<script>
const steps = [
  {
    id:1,
    title:'Client: Create Booking + Estimation',
    status:'pending_review',
    monitored:true, // being monitored
    intervention:true, // manager can intervene at this step
    content:`
<h4>Booking Submitted</h4>
<p>Client John Doe submitted a cleaning booking for 2-bedroom apartment.</p>
<p><strong>Estimated Total:</strong> â‚±5,500</p>
<h4>Tasks Selected</h4>
<ul>
<li>Steam Clean - Living Room</li>
<li>Maintenance Clean - Bedroom</li>
<li>Optional: Clean balcony, Sanitize carpets</li>
</ul>
<h4>Manager Intervention Available</h4>
<button class="action-accept" onclick="advanceStep()">Accept Booking</button>
<button class="action-sitevisit" onclick="advanceStep()">Require Site Visit</button>
`
  },
  {
    id:2,
    title:'Supervisor: Review Booking',
    status:'pending_review',
    monitored:true,
    intervention:true,
    content:`
<h4>Supervisor Dashboard</h4>
<p>Supervisor sees booking summary:</p>
<ul>
<li>Client: John Doe</li>
<li>Estimated Total: â‚±5,500</li>
<li>Tasks: Clean balcony, Sanitize carpets</li>
</ul>
<p>Actions available for Supervisor:</p>
<button class="action-accept" onclick="advanceStep()">Approve Booking</button>
<button class="action-reschedule" onclick="advanceStep()">Request Reschedule</button>
<button class="action-sitevisit" onclick="advanceStep()">Require Site Visit</button>
`
  },
  {
    id:3,
    title:'Site Visit (if required)',
    status:'awaiting_visit',
    monitored:true,
    intervention:false,
    content:`
<h4>Monitoring Site Visit</h4>
<p>Supervisor is performing site visit at client location.</p>
<p>Notes recorded: 2-bedroom apartment, laminate floors, minor stains.</p>
<p>Estimated price updated: â‚±5,800</p>
<p>Photos uploaded: 2 images</p>
`
  },
  {
    id:4,
    title:'Manager: Review & Finalize Quotation',
    status:'visit_completed',
    monitored:true,
    intervention:true,
    content:`
<h4>Quotation Review</h4>
<p>Manager sees booking & supervisor report:</p>
<ul>
<li>Tasks: Clean balcony, Sanitize carpets</li>
<li>Upsell options: Deep-clean add-on</li>
<li>Estimated Price: â‚±5,800</li>
<li>Internal Notes: Check special stains</li>
</ul>
<p>Actions available:</p>
<button class="action-generate" onclick="advanceStep()">Generate Quotation</button>
<button class="action-revision" onclick="advanceStep()">Request Revision</button>
`
  },
  {
    id:5,
    title:'Client: Review Quotation',
    status:'quotation_sent',
    monitored:true,
    intervention:false,
    content:`
<h4>Monitoring Client Review</h4>
<p>Client received quotation for approval.</p>
<ul>
<li>Service Tasks: Clean balcony, Sanitize carpets, Deep-clean add-on</li>
<li>Total: â‚±5,800</li>
<li>Status: Pending client response</li>
</ul>
`
  },
  {
    id:6,
    title:'Client: Pay Invoice',
    status:'quotation_approved',
    monitored:true,
    intervention:false,
    content:`
<h4>Monitoring Payment</h4>
<p>Invoice generated for client payment.</p>
<ul>
<li>Invoice #: INV-0001</li>
<li>Payment Methods: Stripe, PayPal, GCash, Card</li>
<li>Status: Awaiting payment</li>
</ul>
`
  },
  {
    id:7,
    title:'System: Auto-Create Appointment',
    status:'quotation_paid',
    monitored:true,
    intervention:false,
    content:`
<h4>Appointment Created</h4>
<p>Appointment ID: APT-1001</p>
<p>Tasks: Clean balcony, Sanitize carpets, Deep-clean add-on</p>
<p>Status: Waiting for cleaner assignment</p>
`
  },
  {
    id:8,
    title:'Manager: Assign Cleaner(s)',
    status:'appointment_ready',
    monitored:true,
    intervention:true,
    content:`
<h4>Cleaner Assignment</h4>
<p>Available cleaners: Alex Santos, Maria Cruz</p>
<p>Status: Ready to assign</p>
<button class="action-generate" onclick="advanceStep()">Assign Alex Santos</button>
`
  },
  {
    id:9,
    title:'Cleaner: Accept Appointment',
    status:'scheduled',
    monitored:true,
    intervention:false,
    content:`
<h4>Monitoring Cleaner Acceptance</h4>
<p>Cleaner Alex Santos has been assigned.</p>
<p>Status: Awaiting cleaner confirmation</p>
`
  },
  {
    id:10,
    title:'Cleaning Execution',
    status:'in_progress',
    monitored:true,
    intervention:false,
    content:`
<h4>Monitoring Cleaning</h4>
<ul>
<li>Clean balcony: Completed</li>
<li>Sanitize carpets: In Progress</li>
<li>Deep-clean add-on: Pending</li>
</ul>
<p>Photos and remarks being uploaded in real-time.</p>
`
  },
  {
    id:11,
    title:'Manager: Verify Completion',
    status:'service_done',
    monitored:true,
    intervention:true,
    content:`
<h4>Monitoring Verification</h4>
<p>All tasks completed by cleaner.</p>
<p>Photos uploaded: 5 images</p>
<button class="action-complete" onclick="advanceStep()">Mark Service Completed</button>
`
  },
  {
    id:12,
    title:'System: Sync Final Invoice',
    status:'closed',
    monitored:true,
    intervention:false,
    content:`
<h4>Final Invoice Synced</h4>
<p>Invoice #INV-0001 synced to QuickBooks</p>
<p>Booking marked closed.</p>
<p>Thank-you notification sent to client.</p>
`
  }
];

const nodesRow = document.getElementById('nodesRow');
const detailTitle = document.getElementById('detailTitle');
const detailMeta = document.getElementById('detailMeta');
const detailContent = document.getElementById('detailContent');

let activeStep = 0;

// Build step nodes
steps.forEach((s,i)=>{
  const node=document.createElement('div');
  node.classList.add('node'); 
  if(i===activeStep) node.classList.add('active');
  node.innerHTML=`<div class="num">${s.id}</div><div class="label">${s.title}</div>`;
  node.onclick=()=>setActiveStep(i);
  nodesRow.appendChild(node);
  if(i<steps.length-1){
    const connector=document.createElement('div');
    connector.classList.add('connector');
    if(i<activeStep) connector.classList.add('filled');
    nodesRow.appendChild(connector);
  }
});

function setActiveStep(i){
  activeStep=i;
  document.querySelectorAll('.node').forEach((n,idx)=>{
    n.classList.toggle('active', idx===i);
  });
  detailTitle.innerHTML = steps[i].title;
  detailMeta.innerHTML = steps[i].meta;
  detailContent.innerHTML = steps[i].content;
  updateConnectors();
}

function updateConnectors(){
  const conns = document.querySelectorAll('.connector');
  conns.forEach((c,idx)=>{
    c.classList.toggle('filled', idx<activeStep);
  });
}

function advanceStep(){
  if(activeStep<steps.length-1){
    activeStep++;
    setActiveStep(activeStep);
  }
}

// Prev/Next buttons
document.getElementById('prevBtn').onclick = ()=>{ if(activeStep>0){activeStep--;setActiveStep(activeStep)} }
document.getElementById('nextBtn').onclick = ()=>{ if(activeStep<steps.length-1){activeStep++;setActiveStep(activeStep)} }

// Optional: autoplay
let playInterval=null;
document.getElementById('playBtn').onclick=()=>{
  if(playInterval){ clearInterval(playInterval); playInterval=null; return; }
  playInterval=setInterval(()=>{
    if(activeStep<steps.length-1) advanceStep(); else clearInterval(playInterval);
  },2000);
}

// Initialize first step
setActiveStep(activeStep);
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cleaning Service Workflow Dashboard</title>
<style>
  :root{
    --bg:#f7fafc; --card:#ffffff; --accent:#0ea5a4; --muted:#64748b;
    --node-size:80px;
  }
  *{box-sizing:border-box}
  body{font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial; margin:0;background:var(--bg);color:#0f1724;}
  .wrap{max-width:1200px;margin:24px auto;padding:16px}
  h1{font-size:24px;margin:0 0 12px}
  p.lead{color:var(--muted);margin:6px 0 18px}

  .stepper-wrap{background:var(--card);border-radius:12px;padding:14px;border:1px solid rgba(15,23,36,0.04);}
  .controls-row{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:8px}
  .nodes-row{display:flex;align-items:center;gap:12px;padding:8px 6px;overflow:auto;scroll-behavior:smooth}
  .nodes-row::-webkit-scrollbar{height:10px}
  .nodes-row::-webkit-scrollbar-thumb{background:linear-gradient(90deg,var(--accent),#06b6d4);border-radius:8px}

  .node{min-width:var(--node-size);height:var(--node-size);border-radius:50%;background:rgba(14,165,164,0.06);display:flex;align-items:center;justify-content:center;flex-shrink:0;position:relative;cursor:pointer;transition:transform .18s ease,box-shadow .18s}
  .node:hover{transform:translateY(-6px)}
  .node.active{background:linear-gradient(135deg, rgba(14,165,164,0.14), rgba(6,182,212,0.08));box-shadow:0 8px 18px rgba(14,165,164,0.08)}
  .node .num{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:#e6fffb;font-weight:700;color:var(--accent)}
  .node .label{position:absolute;top:calc(100% + 8px);left:50%;transform:translateX(-50%);white-space:nowrap;font-size:12px;color:var(--muted);max-width:120px;overflow:hidden;text-overflow:ellipsis}

  .connector{height:4px;background:linear-gradient(90deg,#e6eef0,#e6eef0);flex:0 0 48px;border-radius:6px}
  .connector.filled{background:linear-gradient(90deg,var(--accent),#06b6d4)}

  .details{margin-top:16px}
  .card{background:var(--card);padding:16px;border-radius:10px;border:1px solid rgba(15,23,36,0.04)}
  .card h3{margin:0 0 8px}
  .card .meta{color:var(--muted);font-size:13px;margin-bottom:10px}
  .card .content{font-size:14px;color:#0f1724;line-height:1.45;white-space:pre-wrap}

  .controls{display:flex;gap:8px;align-items:center}
  .btn{background:transparent;border:1px solid rgba(15,23,36,0.06);padding:8px 12px;border-radius:8px;color:var(--accent);cursor:pointer}
  .btn.primary{background:linear-gradient(90deg,var(--accent),#06b6d4);color:white;border:none}

  table{width:100%;border-collapse:collapse;margin-bottom:12px}
  table, th, td{border:1px solid #e6eef0}
  th,td{padding:6px;text-align:left}
  th{background:#f0fdfa}
  .task-item{display:flex;justify-content:space-between;align-items:center;padding:4px 8px;border-radius:6px;background:#f0fdfa;margin-bottom:4px}
  .task-item button{background:transparent;border:none;color:#ef4444;font-weight:600;cursor:pointer}
  .action-btn button{margin-right:8px;padding:6px 10px;border-radius:6px;border:none;color:white;cursor:pointer}
  .action-accept{background:#10b981;}
  .action-reject{background:#ef4444;}
  .action-reschedule{background:#f59e0b;}
  .action-sitevisit{background:#3b82f6;}
  .action-generate{background:#06b6d4;}
  .action-revision{background:#f97316;}
  .action-complete{background:#14b8a6;}
  .small{font-size:12px;color:var(--muted)}
  @media (max-width:720px){ .wrap{padding:12px} .node .label{display:none} }
</style>
</head>
<body>
<div class="wrap">
  
  <h1>Cleaning Service Workflow Dashboard</h1>
  <p class="lead">Click any step node to view its content and perform actions.</p>
  <div class="stepper-wrap">
    <div class="controls-row">
      <div style="font-weight:700">Workflow Steps</div>
      <div class="controls">
        <button id="prevBtn" class="btn">â—€ Prev</button>
        <button id="nextBtn" class="btn">Next â–¶</button>
        <button id="playBtn" class="btn">Play</button>
      </div>
    </div>
    <div id="nodesRow" class="nodes-row" tabindex="0" aria-label="Workflow steps"></div>
    <div class="details">
      <div id="detailCard" class="card">
        <h3 id="detailTitle">Step</h3>
        <div class="meta" id="detailMeta">Status info</div>
        <div id="detailContent" class="content">Select a step to view details.</div>
      </div>
    </div>
  </div>
</div>

<script>
const steps = [
  {
    id:1,
    title:'Client: Create Booking + Estimation',
    status:'pending_review',
    monitored:true, // being monitored
    intervention:true, // manager can intervene at this step
    content:`
<h4>Booking Submitted</h4>
<p>Client John Doe submitted a cleaning booking for 2-bedroom apartment.</p>
<p><strong>Estimated Total:</strong> â‚±5,500</p>
<h4>Tasks Selected</h4>
<ul>
<li>Steam Clean - Living Room</li>
<li>Maintenance Clean - Bedroom</li>
<li>Optional: Clean balcony, Sanitize carpets</li>
</ul>
<h4>Manager Intervention Available</h4>
<button class="action-accept" onclick="advanceStep()">Accept Booking</button>
<button class="action-sitevisit" onclick="advanceStep()">Require Site Visit</button>
`
  },
  {
    id:2,
    title:'Supervisor: Review Booking',
    status:'pending_review',
    monitored:true,
    intervention:true,
    content:`
<h4>Supervisor Dashboard</h4>
<p>Supervisor sees booking summary:</p>
<ul>
<li>Client: John Doe</li>
<li>Estimated Total: â‚±5,500</li>
<li>Tasks: Clean balcony, Sanitize carpets</li>
</ul>
<p>Actions available for Supervisor:</p>
<button class="action-accept" onclick="advanceStep()">Approve Booking</button>
<button class="action-reschedule" onclick="advanceStep()">Request Reschedule</button>
<button class="action-sitevisit" onclick="advanceStep()">Require Site Visit</button>
`
  },
  {
    id:3,
    title:'Site Visit (if required)',
    status:'awaiting_visit',
    monitored:true,
    intervention:false,
    content:`
<h4>Monitoring Site Visit</h4>
<p>Supervisor is performing site visit at client location.</p>
<p>Notes recorded: 2-bedroom apartment, laminate floors, minor stains.</p>
<p>Estimated price updated: â‚±5,800</p>
<p>Photos uploaded: 2 images</p>
`
  },
  {
    id:4,
    title:'Manager: Review & Finalize Quotation',
    status:'visit_completed',
    monitored:true,
    intervention:true,
    content:`
<h4>Quotation Review</h4>
<p>Manager sees booking & supervisor report:</p>
<ul>
<li>Tasks: Clean balcony, Sanitize carpets</li>
<li>Upsell options: Deep-clean add-on</li>
<li>Estimated Price: â‚±5,800</li>
<li>Internal Notes: Check special stains</li>
</ul>
<p>Actions available:</p>
<button class="action-generate" onclick="advanceStep()">Generate Quotation</button>
<button class="action-revision" onclick="advanceStep()">Request Revision</button>
`
  },
  {
    id:5,
    title:'Client: Review Quotation',
    status:'quotation_sent',
    monitored:true,
    intervention:false,
    content:`
<h4>Monitoring Client Review</h4>
<p>Client received quotation for approval.</p>
<ul>
<li>Service Tasks: Clean balcony, Sanitize carpets, Deep-clean add-on</li>
<li>Total: â‚±5,800</li>
<li>Status: Pending client response</li>
</ul>
`
  },
  {
    id:6,
    title:'Client: Pay Invoice',
    status:'quotation_approved',
    monitored:true,
    intervention:false,
    content:`
<h4>Monitoring Payment</h4>
<p>Invoice generated for client payment.</p>
<ul>
<li>Invoice #: INV-0001</li>
<li>Payment Methods: Stripe, PayPal, GCash, Card</li>
<li>Status: Awaiting payment</li>
</ul>
`
  },
  {
    id:7,
    title:'System: Auto-Create Appointment',
    status:'quotation_paid',
    monitored:true,
    intervention:false,
    content:`
<h4>Appointment Created</h4>
<p>Appointment ID: APT-1001</p>
<p>Tasks: Clean balcony, Sanitize carpets, Deep-clean add-on</p>
<p>Status: Waiting for cleaner assignment</p>
`
  },
  {
    id:8,
    title:'Manager: Assign Cleaner(s)',
    status:'appointment_ready',
    monitored:true,
    intervention:true,
    content:`
<h4>Cleaner Assignment</h4>
<p>Available cleaners: Alex Santos, Maria Cruz</p>
<p>Status: Ready to assign</p>
<button class="action-generate" onclick="advanceStep()">Assign Alex Santos</button>
`
  },
  {
    id:9,
    title:'Cleaner: Accept Appointment',
    status:'scheduled',
    monitored:true,
    intervention:false,
    content:`
<h4>Monitoring Cleaner Acceptance</h4>
<p>Cleaner Alex Santos has been assigned.</p>
<p>Status: Awaiting cleaner confirmation</p>
`
  },
  {
    id:10,
    title:'Cleaning Execution',
    status:'in_progress',
    monitored:true,
    intervention:false,
    content:`
<h4>Monitoring Cleaning</h4>
<ul>
<li>Clean balcony: Completed</li>
<li>Sanitize carpets: In Progress</li>
<li>Deep-clean add-on: Pending</li>
</ul>
<p>Photos and remarks being uploaded in real-time.</p>
`
  },
  {
    id:11,
    title:'Manager: Verify Completion',
    status:'service_done',
    monitored:true,
    intervention:true,
    content:`
<h4>Monitoring Verification</h4>
<p>All tasks completed by cleaner.</p>
<p>Photos uploaded: 5 images</p>
<button class="action-complete" onclick="advanceStep()">Mark Service Completed</button>
`
  },
  {
    id:12,
    title:'System: Sync Final Invoice',
    status:'closed',
    monitored:true,
    intervention:false,
    content:`
<h4>Final Invoice Synced</h4>
<p>Invoice #INV-0001 synced to QuickBooks</p>
<p>Booking marked closed.</p>
<p>Thank-you notification sent to client.</p>
`
  }
];

const nodesRow = document.getElementById('nodesRow');
const detailTitle = document.getElementById('detailTitle');
const detailMeta = document.getElementById('detailMeta');
const detailContent = document.getElementById('detailContent');

let activeStep = 0;

// Build step nodes
steps.forEach((s,i)=>{
  const node=document.createElement('div');
  node.classList.add('node'); 
  if(i===activeStep) node.classList.add('active');
  node.innerHTML=`<div class="num">${s.id}</div><div class="label">${s.title}</div>`;
  node.onclick=()=>setActiveStep(i);
  nodesRow.appendChild(node);
  if(i<steps.length-1){
    const connector=document.createElement('div');
    connector.classList.add('connector');
    if(i<activeStep) connector.classList.add('filled');
    nodesRow.appendChild(connector);
  }
});

function setActiveStep(i){
  activeStep=i;
  document.querySelectorAll('.node').forEach((n,idx)=>{
    n.classList.toggle('active', idx===i);
  });
  detailTitle.innerHTML = steps[i].title;
  detailMeta.innerHTML = steps[i].meta;
  detailContent.innerHTML = steps[i].content;
  updateConnectors();
}

function updateConnectors(){
  const conns = document.querySelectorAll('.connector');
  conns.forEach((c,idx)=>{
    c.classList.toggle('filled', idx<activeStep);
  });
}

function advanceStep(){
  if(activeStep<steps.length-1){
    activeStep++;
    setActiveStep(activeStep);
  }
}

// Prev/Next buttons
document.getElementById('prevBtn').onclick = ()=>{ if(activeStep>0){activeStep--;setActiveStep(activeStep)} }
document.getElementById('nextBtn').onclick = ()=>{ if(activeStep<steps.length-1){activeStep++;setActiveStep(activeStep)} }

// Optional: autoplay
let playInterval=null;
document.getElementById('playBtn').onclick=()=>{
  if(playInterval){ clearInterval(playInterval); playInterval=null; return; }
  playInterval=setInterval(()=>{
    if(activeStep<steps.length-1) advanceStep(); else clearInterval(playInterval);
  },2000);
}

// Initialize first step
setActiveStep(activeStep);
</script>
</body>
</html>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; background:#f4f4f9; }
    h2 { color:#007bff; }
    .section { margin-bottom:20px; }
    .total-box { font-size: 18px; font-weight: bold; margin-top: 20px; color:#007bff; }
    button { background:#007bff; color:#fff; border:none; border-radius:5px; padding:5px 10px; cursor:pointer; }
    table { width:100%; border-collapse:collapse; margin:10px 0; }
    th, td { border:1px solid #ddd; padding:8px; text-align:center; }
    th { background:#007bff; color:#fff; }
    input[type=range] { width: 120px; }
    .small-note { font-size: 13px; color: #555; }
    /* ðŸ”¹ Added Visit Estimation styles */
.alert-box { color: red; font-weight: bold; margin-top:10px; display:none; }
.success-msg { color: green; font-weight: bold; margin-top:10px; display:none; }
button:disabled { background: gray; cursor: not-allowed; }
    pre.invoice { font-family: monospace; white-space: pre-wrap; margin:0; }
  </style>
</head>
<body>
  <div class="buttons">
    <button onclick="location.href='./estimation.html'">Open Steam Estimator</button>
  </div>

  <h2>Cleaning Service Estimator (Maintenance)</h2>

  <!-- Service Options -->
  <div class="section">
    <label><input type="checkbox" id="serviceMaintenance" onchange="calculateEstimate()"> Maintenance Clean</label><br>
    <label><input type="checkbox" id="serviceMoveout" onchange="calculateEstimate()"> Move Out Clean</label><br>
    <label><input type="checkbox" id="serviceDeep" onchange="calculateEstimate()"> Deep Clean</label><br>
    <label><input type="checkbox" id="serviceSteam" onchange="calculateEstimate()"> Include Steam Clean (from Estimator)</label>
    <div class="small-note">Tip: open <strong>Steam Estimator</strong>, calculate & save there first â€” then check "Include Steam Clean" here to pull the exact Steam invoice/total.</div>
  </div>

  <!-- Maintenance Options -->
  <div id="maintenanceOptions" style="display:none; margin-top:15px;">
    <h3>Maintenance Clean Options</h3>
    <p id="residentialNote" class="small-note" style="display:none;">Minimum booking for maintenance is <strong>3 hours</strong>.</p>

    <label><input type="radio" name="rateType" value="residential" onchange="calculateEstimate()"> Residential ($38/hr)</label>
    <label><input type="radio" name="rateType" value="commercial" onchange="calculateEstimate()"> Commercial ($44/hr)</label>
    <!-- ðŸ”¹ Visit Estimation Toggle (only for Commercial) -->
<div id="visitOption" style="display:none; margin-top:10px;">
  <label><input type="checkbox" id="visitEstimation" onchange="toggleVisitEstimation()"> Visit Estimation</label>
  <div id="visitAlert" class="alert-box">âš  Invoice is paused until visit estimation is processed.</div>
  <div id="visitSuccess" class="success-msg">âœ… Visit estimation finalized. You can now proceed to booking.</div>
</div>

    <table>
      <tr><th>Room</th><th>Base Hours</th><th>Large?</th><th>Extra Hours (drag)</th><th>Total Hours</th></tr>
      <tr>
        <td>Kitchen</td><td>3</td>
        <td><input type="checkbox" id="kitchenLarge" onchange="calculateEstimate()"> +1.5 hrs</td>
        <td>
          <input type="range" id="kitchenExtra" min="0" max="5" step="0.25" value="0" oninput="calculateEstimate()">
          <div class="small-note"><span id="kitchenExtraDisplay">0.00</span> hrs</div>
        </td>
        <td id="kitchenHours">3.00</td>
      </tr>
      <tr>
        <td>Bedroom</td><td>1</td>
        <td><input type="checkbox" id="bedroomLarge" onchange="calculateEstimate()"> +0.5 hrs</td>
        <td>
          <input type="range" id="bedroomExtra" min="0" max="5" step="0.25" value="0" oninput="calculateEstimate()">
          <div class="small-note"><span id="bedroomExtraDisplay">0.00</span> hrs</div>
        </td>
        <td id="bedroomHours">1.00</td>
      </tr>
      <tr>
        <td>Bathroom</td><td>2.5</td>
        <td><input type="checkbox" id="bathroomLarge" onchange="calculateEstimate()"> +1.0 hrs</td>
        <td>
          <input type="range" id="bathroomExtra" min="0" max="5" step="0.25" value="0" oninput="calculateEstimate()">
          <div class="small-note"><span id="bathroomExtraDisplay">0.00</span> hrs</div>
        </td>
        <td id="bathroomHours">2.50</td>
      </tr>
      <tr>
        <td>Entryway</td><td>0.5</td>
        <td><input type="checkbox" disabled> (fixed)</td>
        <td>
          <input type="range" id="entryExtra" min="0" max="3" step="0.25" value="0" oninput="calculateEstimate()">
          <div class="small-note"><span id="entryExtraDisplay">0.00</span> hrs</div>
        </td>
        <td id="entryHours">0.50</td>
      </tr>
    </table>
  </div>

<!-- Smart Move Out Estimator -->
<div id="moveoutOptions" style="display:none; margin-top:15px;">
  <h3>Move Out Smart Estimator</h3>
  <p>Automatically estimates hours based on size and hourly rate (no fixed price).</p>

  <label>Home Size:</label><br>
  <select id="moveoutSize" onchange="calculateEstimate()" style="padding:5px; border-radius:5px;">
    <option value="small" selected>Small â€” 7â€“8 hrs</option>
    <option value="medium">Medium â€” 9â€“15 hrs</option>
    <option value="large">Large â€” 15+ hrs</option>
  </select><br><br>

  <label>Approximate Square Footage:</label><br>
  <input type="number" id="moveoutSqft" placeholder="e.g. 1800" min="300" step="50"
         oninput="calculateEstimate()" style="padding:5px; border-radius:5px; width:120px;"><br><br>

  <label>Hourly Rate ($):</label><br>
  <input type="number" id="moveoutRate" placeholder="e.g. 50" min="20" step="1" value="50"
         oninput="calculateEstimate()" style="padding:5px; border-radius:5px; width:100px;"><br><br>

  <div style="margin-top:8px;">
    <strong>Estimated Hours:</strong> <span id="moveoutHoursDisplay">0.00</span><br>
    <strong>Estimated Cost:</strong> $<span id="moveoutCostDisplay">0.00</span>
  </div>
</div>


<!-- Smart Deep Clean Estimator -->
<div id="deepOptions" style="display:none; margin-top:15px;">
  <h3>Deep Clean Smart Estimator</h3>
  <p>Estimate dynamically based on home size (no fixed rate).</p>

  <label>Home Size:</label><br>
  <select id="deepSize" onchange="calculateEstimate()" style="padding:5px; border-radius:5px;">
    <option value="small" selected>Small â€” minimum 7â€“8 hrs</option>
    <option value="medium">Medium â€” 9â€“15 hrs</option>
    <option value="large">Large â€” 15+ hrs</option>
  </select><br><br>

  <label>Approximate Square Footage:</label><br>
  <input type="number" id="deepSqft" placeholder="e.g. 1500" min="300" step="50" 
         oninput="calculateEstimate()" style="padding:5px; border-radius:5px; width:120px;"><br><br>

  <label>Hourly Rate ($):</label><br>
  <input type="number" id="deepRate" placeholder="e.g. 50" min="20" step="1" value="50"
         oninput="calculateEstimate()" style="padding:5px; border-radius:5px; width:100px;"><br><br>

  <p class="small-note">Minimum 7 hours for small homes. Larger spaces may increase hours automatically.</p>

  <div style="margin-top:8px;">
    <strong>Estimated Hours:</strong> <span id="deepHoursDisplay">0.00</span><br>
    <strong>Estimated Cost:</strong> $<span id="deepCostDisplay">0.00</span>
  </div>
</div>

<!-- Travel Time Fee Estimator -->
<div id="travelOptions" style="margin-top:15px;">
  <h3>Travel Time Fee Estimation</h3>
  <p>Estimate additional cost based on travel duration.</p>

  <label>Rate Type:</label><br>
  <select id="travelType" onchange="calculateEstimate()" style="padding:5px; border-radius:5px;">
    <option value="residential" selected>Residential ($38/hr)</option>
    <option value="commercial">Commercial ($44/hr)</option>
  </select><br><br>

  <label>Travel Time (minutes):</label><br>
  <input type="number" id="travelMinutes" placeholder="e.g. 45" min="0" max="120" step="5"
         oninput="calculateEstimate()" style="padding:5px; border-radius:5px; width:100px;"><br><br>

  <div>
    <strong>Travel Fee:</strong> $<span id="travelCostDisplay">0.00</span>
  </div>
</div>



<div class="total-box">
  <h3>Final Estimate Invoice</h3>
  <pre id="finalInvoice" class="invoice"></pre>

  <!-- ðŸ”¹ Added Visit Estimation Finalization and Book Button -->
  <button id="finalizeVisitBtn" style="display:none;" onclick="finalizeVisitEstimation()">Finalize Visit Estimation</button>
  <button id="bookButton" disabled>Book Service</button>
</div>


  

  <script>

    // ðŸ”¹ Handle Commercial toggle visibility
function toggleVisitOption() {
  const rateType = document.querySelector('input[name="rateType"]:checked').value;
  document.getElementById("visitOption").style.display = (rateType === "commercial") ? "block" : "none";

  if (rateType !== "commercial") {
    document.getElementById("visitEstimation").checked = false;
    toggleVisitEstimation(false);
  }
}

// ðŸ”¹ Handle Visit Estimation behavior
function toggleVisitEstimation() {
  const isVisit = document.getElementById("visitEstimation").checked;
  const alertBox = document.getElementById("visitAlert");
  const successBox = document.getElementById("visitSuccess");
  const bookBtn = document.getElementById("bookButton");
  const finalizeBtn = document.getElementById("finalizeVisitBtn");

  if (isVisit) {
    alertBox.style.display = "block";
    successBox.style.display = "none";
    finalizeBtn.style.display = "inline-block";
    bookBtn.disabled = true;
    alert("Invoice is paused until visit estimation is processed. You can still estimate, but cannot book until the visit is complete.");
  } else {
    alertBox.style.display = "none";
    successBox.style.display = "none";
    finalizeBtn.style.display = "none";
    bookBtn.disabled = false;
  }

  calculateEstimate();
}

// ðŸ”¹ When visit estimation finalized
function finalizeVisitEstimation() {
  document.getElementById("visitAlert").style.display = "none";
  document.getElementById("visitSuccess").style.display = "block";
  document.getElementById("bookButton").disabled = false;
  document.getElementById("finalizeVisitBtn").style.display = "none";
  alert("Visit estimation finalized. You can now proceed to booking.");
}

    // Main calculator
    function calculateEstimate() {
      const breakdown = [];
      let subtotal = 0;

      // ----- Maintenance -----
      if (document.getElementById("serviceMaintenance").checked) {
        document.getElementById("maintenanceOptions").style.display = "block";

        const rateType = document.querySelector('input[name="rateType"]:checked').value;
        const rate = (rateType === "residential") ? 38 : 44;
        toggleVisitOption();
        // Show note only for residential
if (rateType === "residential") {
  document.getElementById("residentialNote").style.display = "block";
} else {
  document.getElementById("residentialNote").style.display = "none";
}

        // kitchen
        let kitchenBase = 4;
        let kitchenLargeAdd = document.getElementById("kitchenLarge").checked ? 1.5 : 0;
        let kitchenExtra = parseFloat(document.getElementById("kitchenExtra").value) || 0;
        let kitchen = round2(kitchenBase + kitchenLargeAdd + kitchenExtra);
        document.getElementById("kitchenExtraDisplay").innerText = kitchenExtra.toFixed(2);
        document.getElementById("kitchenHours").innerText = kitchen.toFixed(2);

        // bedroom
        let bedroomBase = 1;
        let bedroomLargeAdd = document.getElementById("bedroomLarge").checked ? 0.5 : 0;
        let bedroomExtra = parseFloat(document.getElementById("bedroomExtra").value) || 0;
        let bedroom = round2(bedroomBase + bedroomLargeAdd + bedroomExtra);
        document.getElementById("bedroomExtraDisplay").innerText = bedroomExtra.toFixed(2);
        document.getElementById("bedroomHours").innerText = bedroom.toFixed(2);

        // bathroom
        let bathroomBase = 2.5;
        let bathroomLargeAdd = document.getElementById("bathroomLarge").checked ? 1 : 0;
        let bathroomExtra = parseFloat(document.getElementById("bathroomExtra").value) || 0;
        let bathroom = round2(bathroomBase + bathroomLargeAdd + bathroomExtra);
        document.getElementById("bathroomExtraDisplay").innerText = bathroomExtra.toFixed(2);
        document.getElementById("bathroomHours").innerText = bathroom.toFixed(2);

        // entryway
        let entryBase = 0.5;
        let entryExtra = parseFloat(document.getElementById("entryExtra").value) || 0;
        let entryway = round2(entryBase + entryExtra);
        document.getElementById("entryExtraDisplay").innerText = entryExtra.toFixed(2);
        document.getElementById("entryHours").innerText = entryway.toFixed(2);

        // total hours and minimum enforcement
        let totalHours = kitchen + bedroom + bathroom + entryway;
let minHours;

if (rateType === "residential") {
  minHours = 3; // Minimum 3 hours for residential
} else {
  minHours = 6; // 3 hrs x 2 cleaners for commercial
}

let totalHoursApplied = (totalHours < minHours) ? minHours : totalHours;


        let maintenanceCost = round2(totalHoursApplied * rate);
        subtotal += maintenanceCost;
        breakdown.push(`Maintenance Clean (${rateType}, ${totalHoursApplied.toFixed(2)} hrs @ $${rate}/hr) .... $${maintenanceCost.toFixed(2)}`);
      } else {
        // hide maintenance options if not checked
        document.getElementById("maintenanceOptions").style.display = "none";
      }

      // ----- Steam Clean (pull from estimation.html via localStorage) -----
      if (document.getElementById("serviceSteam").checked) {
        document.getElementById("serviceSteam").checked = true; // ensure UI state
        const steamInvoice = localStorage.getItem("steamInvoice");
        const steamTotal = parseFloat(localStorage.getItem("steamTotal") || "0");

        if (steamInvoice && steamTotal > 0) {
          subtotal += steamTotal;
          breakdown.push("---- Included Steam Clean Invoice (pulled from estimator) ----");
          // include steam invoice text as-is (keeps formatting)
          breakdown.push(steamInvoice);
        } else {
          // fallback
          const fallbackSteam = 120;
          subtotal += fallbackSteam;
          breakdown.push(`Steam Clean (basic package) ................. $${fallbackSteam.toFixed(2)}`);
        }
      }

    // ----- Smart Move Out Estimator -----
if (document.getElementById("serviceMoveout").checked) {
  document.getElementById("moveoutOptions").style.display = "block";

  const size = document.getElementById("moveoutSize").value;
  const sqft = parseFloat(document.getElementById("moveoutSqft").value) || 0;
  const rate = parseFloat(document.getElementById("moveoutRate").value) || 0;

  let baseHours =
    (size === "small") ? 7 :
    (size === "medium") ? 10 : 15;

  let sqftFactor =
    (size === "small") ? sqft / 300 :
    (size === "medium") ? sqft / 250 : sqft / 200;

  let estimatedHours = Math.max(baseHours, sqftFactor);
  const totalCost = round2(estimatedHours * rate);

  document.getElementById("moveoutHoursDisplay").innerText = estimatedHours.toFixed(2);
  document.getElementById("moveoutCostDisplay").innerText = totalCost.toFixed(2);

  if (rate > 0 && sqft > 0) {
    subtotal += totalCost;
    breakdown.push(
      `Move Out Clean (${size}) â€” ${sqft.toFixed(0)} sqft, ${estimatedHours.toFixed(2)} hrs @ $${rate}/hr ......... $${totalCost.toFixed(2)}`
    );
  }
} else {
  document.getElementById("moveoutOptions").style.display = "none";
}



// ----- Smart Deep Clean Estimator -----
if (document.getElementById("serviceDeep").checked) {
  document.getElementById("deepOptions").style.display = "block";

  const size = document.getElementById("deepSize").value;
  const sqft = parseFloat(document.getElementById("deepSqft").value) || 0;
  const rate = parseFloat(document.getElementById("deepRate").value) || 0;

  // Estimate hours based on size and sqft
  let baseHours =
    (size === "small") ? 7 :
    (size === "medium") ? 10 : 15;

  let sqftFactor =
    (size === "small") ? sqft / 300 :
    (size === "medium") ? sqft / 250 : sqft / 200;

  let estimatedHours = Math.max(baseHours, sqftFactor);
  const totalCost = round2(estimatedHours * rate);

  document.getElementById("deepHoursDisplay").innerText = estimatedHours.toFixed(2);
  document.getElementById("deepCostDisplay").innerText = totalCost.toFixed(2);

  if (rate > 0 && sqft > 0) {
    subtotal += totalCost;
    breakdown.push(
      `Deep Clean (${size}) â€” ${sqft.toFixed(0)} sqft, ${estimatedHours.toFixed(2)} hrs @ $${rate}/hr ......... $${totalCost.toFixed(2)}`
    );
  }
} else {
  document.getElementById("deepOptions").style.display = "none";
}

// ----- Travel Time Fee Estimator -----
const travelType = document.getElementById("travelType").value;
const travelMinutes = parseFloat(document.getElementById("travelMinutes").value) || 0;
const travelRate = (travelType === "residential") ? 38 : 44;

if (travelMinutes > 0) {
  const travelHours = travelMinutes / 60;
  const travelCost = round2(travelHours * travelRate);
  document.getElementById("travelCostDisplay").innerText = travelCost.toFixed(2);
  subtotal += travelCost;
  breakdown.push(
    `Travel Time Fee (${travelType}) â€” ${travelMinutes} mins @ $${travelRate}/hr ......... $${travelCost.toFixed(2)}`
  );
} else {
  document.getElementById("travelCostDisplay").innerText = "0.00";
}


      // ----- Tax & total -----
      const tax = round2(subtotal * 0.05);
      const total = round2(subtotal + tax);

      // Build final invoice text clearly
      let invoiceText = `FINAL CLEANING ESTIMATE
--------------------------------
${breakdown.join("\n\n")}
--------------------------------
Subtotal: $${subtotal.toFixed(2)}
Tax (5%): $${tax.toFixed(2)}
TOTAL DUE: $${total.toFixed(2)}
`;

      document.getElementById("finalInvoice").innerText = invoiceText;
    }

    // small helper to avoid float precision issues
    function round2(n){ return Math.round(n*100)/100; }

    // recalc when ANY input changes (checkbox/radio/range)
    document.addEventListener('input', function(e){
  const relevantTypes = ['checkbox','radio','range','number','select-one'];
  if (relevantTypes.includes(e.target.type) || e.target.name === 'rateType') {
    calculateEstimate();
  }
});

    // Also recalc on load (pulls Steam if available)
    document.addEventListener('DOMContentLoaded', calculateEstimate);
    // Fix: Ensure immediate recalculation when switching Residential/Commercial
document.querySelectorAll('input[name="rateType"]').forEach(radio => {
  radio.addEventListener('click', calculateEstimate);
});

  </script>
</body>
</html>
